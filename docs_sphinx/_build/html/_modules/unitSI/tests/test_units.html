<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>unitSI.tests.test_units &#8212; unitSI v1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=e160b93e"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for unitSI.tests.test_units</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_equal</span>

<span class="kn">from</span> <span class="nn">unitSI.unitsafefunctions</span> <span class="kn">import</span> <span class="n">arange</span><span class="p">,</span> <span class="n">linspace</span> 
<span class="kn">from</span> <span class="nn">unitSI.allunits</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">unitSI.fundamentalunits</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DIMENSIONLESS</span><span class="p">,</span>
    <span class="n">UFUNCS_DIMENSIONLESS</span><span class="p">,</span>
    <span class="n">UFUNCS_DIMENSIONLESS_TWOARGS</span><span class="p">,</span>
    <span class="n">UFUNCS_INTEGERS</span><span class="p">,</span>
    <span class="n">UFUNCS_LOGICAL</span><span class="p">,</span>
    <span class="n">DimensionMismatchError</span><span class="p">,</span>
    <span class="n">Quantity</span><span class="p">,</span>
    <span class="n">Unit</span><span class="p">,</span>
    <span class="n">check_units</span><span class="p">,</span>
    <span class="n">fail_for_dimension_mismatch</span><span class="p">,</span>
    <span class="n">get_dimensions</span><span class="p">,</span>
    <span class="n">get_or_create_dimension</span><span class="p">,</span>
    <span class="n">get_unit</span><span class="p">,</span>
    <span class="n">have_same_dimensions</span><span class="p">,</span>
    <span class="n">in_unit</span><span class="p">,</span>
    <span class="n">is_dimensionless</span><span class="p">,</span>
    <span class="n">is_scalar_type</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">unitSI.stdunits</span> <span class="kn">import</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">kHz</span><span class="p">,</span> <span class="n">mM</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">mV</span><span class="p">,</span> <span class="n">nA</span><span class="p">,</span> <span class="n">nS</span>

<span class="c1"># To work around an issue in matplotlib 1.3.1 (see</span>
<span class="c1"># https://github.com/matplotlib/matplotlib/pull/2591), we make `ravel`</span>
<span class="c1"># return a unitless array and emit a warning explaining the issue.</span>
<span class="n">use_matplotlib_units_fix</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>

    <span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">__version__</span> <span class="o">==</span> <span class="s2">&quot;1.3.1&quot;</span><span class="p">:</span>
        <span class="n">use_matplotlib_units_fix</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="assert_quantity">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.assert_quantity">[docs]</a>
<span class="k">def</span> <span class="nf">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
    <span class="p">),</span> <span class="n">q</span>
    <span class="c1"># assert_allclose(np.asarray(q), values)</span>
    <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">unit</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Dimension mismatch: (</span><span class="si">{</span><span class="n">get_dimensions</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="si">}</span><span class="s2">) (</span><span class="si">{</span><span class="n">get_dimensions</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span></div>



<div class="viewcode-block" id="test_construction">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_construction">[docs]</a>
<span class="k">def</span> <span class="nf">test_construction</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the construction of quantity objects&quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="n">ms</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="o">*</span> <span class="n">ms</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="o">*</span> <span class="n">ms</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span> <span class="o">*</span> <span class="n">ms</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">second</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="n">second</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">dim</span><span class="o">=</span><span class="n">second</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">500</span> <span class="o">*</span> <span class="n">ms</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">second</span><span class="p">])</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="o">.</span><span class="n">with_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">second</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="p">)</span>

    <span class="c1"># dimensionless quantities</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">Unit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">Unit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([])</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">Unit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># copying/referencing a quantity</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">Quantity</span><span class="o">.</span><span class="n">with_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>  <span class="c1"># no copy</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">q1</span><span class="p">)</span>
    <span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">second</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span>

    <span class="n">q1</span> <span class="o">=</span> <span class="n">Quantity</span><span class="o">.</span><span class="n">with_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">second</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># copy</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">q1</span><span class="p">)</span>
    <span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">second</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span>

    <span class="c1"># Illegal constructor calls</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">Quantity</span><span class="p">([</span><span class="mi">500</span> <span class="o">*</span> <span class="n">ms</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">Quantity</span><span class="p">([</span><span class="s2">&quot;some&quot;</span><span class="p">,</span> <span class="s2">&quot;nonsense&quot;</span><span class="p">])</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">Quantity</span><span class="p">([</span><span class="mi">500</span> <span class="o">*</span> <span class="n">ms</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">volt</span><span class="p">])</span></div>



<div class="viewcode-block" id="test_get_dimensions">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_get_dimensions">[docs]</a>
<span class="k">def</span> <span class="nf">test_get_dimensions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test various ways of getting/comparing the dimensions of a quantity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="n">ms</span>
    <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="n">get_or_create_dimension</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">_dims</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="n">q</span><span class="o">.</span><span class="n">dimensions</span>
    <span class="k">assert</span> <span class="n">q</span><span class="o">.</span><span class="n">has_same_dimensions</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">dimensions</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">dims</span><span class="o">.</span><span class="n">get_dimension</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">dims</span><span class="o">.</span><span class="n">get_dimension</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">is_scalar_type</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_scalar_type</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_scalar_type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">is_scalar_type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">is_scalar_type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">is_scalar_type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">get_dimensions</span><span class="p">(</span><span class="s2">&quot;a string&quot;</span><span class="p">)</span>
    <span class="c1"># wrong number of indices</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">get_or_create_dimension</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="c1"># not a sequence</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">get_or_create_dimension</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_display">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_display">[docs]</a>
<span class="k">def</span> <span class="nf">test_display</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test displaying a quantity in different units</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">in_unit</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">volt</span><span class="p">,</span> <span class="n">mvolt</span><span class="p">),</span> <span class="s2">&quot;3000. mV&quot;</span><span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">in_unit</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">ohm</span> <span class="o">*</span> <span class="n">amp</span><span class="p">),</span> <span class="s2">&quot;0.01 ohm A&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">in_unit</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">nS</span><span class="p">,</span> <span class="n">ohm</span><span class="p">)</span>

    <span class="c1"># A bit artificial...</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">in_unit</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">Unit</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="s2">&quot;1.0&quot;</span><span class="p">)</span></div>




<span class="c1"># def test_scale():</span>
<span class="c1">#     # Check that unit scaling is implemented correctly</span>
<span class="c1">#     from brian2units.core.namespace import DEFAULT_UNITS</span>

<span class="c1">#     siprefixes = {</span>
<span class="c1">#         &quot;y&quot;: 1e-24,</span>
<span class="c1">#         &quot;z&quot;: 1e-21,</span>
<span class="c1">#         &quot;a&quot;: 1e-18,</span>
<span class="c1">#         &quot;f&quot;: 1e-15,</span>
<span class="c1">#         &quot;p&quot;: 1e-12,</span>
<span class="c1">#         &quot;n&quot;: 1e-9,</span>
<span class="c1">#         &quot;u&quot;: 1e-6,</span>
<span class="c1">#         &quot;m&quot;: 1e-3,</span>
<span class="c1">#         &quot;&quot;: 1.0,</span>
<span class="c1">#         &quot;k&quot;: 1e3,</span>
<span class="c1">#         &quot;M&quot;: 1e6,</span>
<span class="c1">#         &quot;G&quot;: 1e9,</span>
<span class="c1">#         &quot;T&quot;: 1e12,</span>
<span class="c1">#         &quot;P&quot;: 1e15,</span>
<span class="c1">#         &quot;E&quot;: 1e18,</span>
<span class="c1">#         &quot;Z&quot;: 1e21,</span>
<span class="c1">#         &quot;Y&quot;: 1e24,</span>
<span class="c1">#     }</span>
<span class="c1">#     for prefix in siprefixes:</span>
<span class="c1">#         if prefix in [&quot;c&quot;, &quot;d&quot;, &quot;da&quot;, &quot;h&quot;]:</span>
<span class="c1">#             continue</span>
<span class="c1">#         scaled_unit = DEFAULT_UNITS[f&quot;{prefix}meter&quot;]</span>
<span class="c1">#         assert_allclose(float(scaled_unit), siprefixes[prefix])</span>
<span class="c1">#         assert_allclose(5 * scaled_unit / meter, 5 * siprefixes[prefix])</span>
<span class="c1">#         scaled_unit = DEFAULT_UNITS[f&quot;{prefix}meter2&quot;]</span>
<span class="c1">#         assert_allclose(float(scaled_unit), siprefixes[prefix] ** 2)</span>
<span class="c1">#         assert_allclose(5 * scaled_unit / meter2, 5 * siprefixes[prefix] ** 2)</span>
<span class="c1">#         scaled_unit = DEFAULT_UNITS[f&quot;{prefix}meter3&quot;]</span>
<span class="c1">#         assert_allclose(float(scaled_unit), siprefixes[prefix] ** 3)</span>
<span class="c1">#         assert_allclose(5 * scaled_unit / meter3, 5 * siprefixes[prefix] ** 3)</span>
<span class="c1">#         # liter, gram, and molar are special, they are not base units with a</span>
<span class="c1">#         # value of one, even though they do not have any prefix</span>
<span class="c1">#         for unit, factor in [</span>
<span class="c1">#             (&quot;liter&quot;, 1e-3),</span>
<span class="c1">#             (&quot;litre&quot;, 1e-3),</span>
<span class="c1">#             (&quot;gram&quot;, 1e-3),</span>
<span class="c1">#             (&quot;gramme&quot;, 1e-3),</span>
<span class="c1">#             (&quot;molar&quot;, 1e3),</span>
<span class="c1">#         ]:</span>
<span class="c1">#             base_unit = DEFAULT_UNITS[unit]</span>
<span class="c1">#             scaled_unit = DEFAULT_UNITS[prefix + unit]</span>
<span class="c1">#             assert_allclose(float(scaled_unit), siprefixes[prefix] * factor)</span>
<span class="c1">#             assert_allclose(5 * scaled_unit / base_unit, 5 * siprefixes[prefix])</span>



<div class="viewcode-block" id="test_pickling">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_pickling">[docs]</a>
<span class="k">def</span> <span class="nf">test_pickling</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test pickling of units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="mi">500</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span>
        <span class="mi">500</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">ms</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="n">pickled</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">unpickled</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unpickled</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">unpickled</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">unpickled</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_dimension_singletons">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_dimension_singletons">[docs]</a>
<span class="k">def</span> <span class="nf">test_dimension_singletons</span><span class="p">():</span>
    <span class="c1"># Make sure that Dimension objects are singletons, even when pickled</span>
    <span class="n">volt_dim</span> <span class="o">=</span> <span class="n">get_or_create_dimension</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">volt</span><span class="o">.</span><span class="n">dim</span> <span class="ow">is</span> <span class="n">volt_dim</span>
    <span class="kn">import</span> <span class="nn">pickle</span>

    <span class="n">pickled_dim</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">volt_dim</span><span class="p">)</span>
    <span class="n">unpickled_dim</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickled_dim</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">unpickled_dim</span> <span class="ow">is</span> <span class="n">volt_dim</span>
    <span class="k">assert</span> <span class="n">unpickled_dim</span> <span class="ow">is</span> <span class="n">volt</span><span class="o">.</span><span class="n">dim</span></div>




<div class="viewcode-block" id="test_str_repr">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_str_repr">[docs]</a>
<span class="k">def</span> <span class="nf">test_str_repr</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that str representations do not raise any errors and that repr</span>
<span class="sd">    fullfills eval(repr(x)) == x. Also test generating LaTeX representations via sympy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sympy</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>  <span class="c1"># necessary for evaluating repr</span>

    <span class="n">units_which_should_exist</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">metre</span><span class="p">,</span>
        <span class="n">meter</span><span class="p">,</span>
        <span class="n">kilogram</span><span class="p">,</span>
        <span class="n">kilogramme</span><span class="p">,</span>
        <span class="n">second</span><span class="p">,</span>
        <span class="n">amp</span><span class="p">,</span>
        <span class="n">kelvin</span><span class="p">,</span>
        <span class="n">mole</span><span class="p">,</span>
        <span class="n">candle</span><span class="p">,</span>
        <span class="n">radian</span><span class="p">,</span>
        <span class="n">steradian</span><span class="p">,</span>
        <span class="n">hertz</span><span class="p">,</span>
        <span class="n">newton</span><span class="p">,</span>
        <span class="n">pascal</span><span class="p">,</span>
        <span class="n">joule</span><span class="p">,</span>
        <span class="n">watt</span><span class="p">,</span>
        <span class="n">coulomb</span><span class="p">,</span>
        <span class="n">volt</span><span class="p">,</span>
        <span class="n">farad</span><span class="p">,</span>
        <span class="n">ohm</span><span class="p">,</span>
        <span class="n">siemens</span><span class="p">,</span>
        <span class="n">weber</span><span class="p">,</span>
        <span class="n">tesla</span><span class="p">,</span>
        <span class="n">henry</span><span class="p">,</span>
        <span class="n">lumen</span><span class="p">,</span>
        <span class="n">lux</span><span class="p">,</span>
        <span class="n">becquerel</span><span class="p">,</span>
        <span class="n">gray</span><span class="p">,</span>
        <span class="n">sievert</span><span class="p">,</span>
        <span class="n">katal</span><span class="p">,</span>
        <span class="n">gram</span><span class="p">,</span>
        <span class="n">gramme</span><span class="p">,</span>
        <span class="n">molar</span><span class="p">,</span>
        <span class="n">liter</span><span class="p">,</span>
        <span class="n">litre</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># scaled versions of all these units should exist (we just check farad as an example)</span>
    <span class="n">some_scaled_units</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Yfarad</span><span class="p">,</span>
        <span class="n">Zfarad</span><span class="p">,</span>
        <span class="n">Efarad</span><span class="p">,</span>
        <span class="n">Pfarad</span><span class="p">,</span>
        <span class="n">Tfarad</span><span class="p">,</span>
        <span class="n">Gfarad</span><span class="p">,</span>
        <span class="n">Mfarad</span><span class="p">,</span>
        <span class="n">kfarad</span><span class="p">,</span>
        <span class="n">hfarad</span><span class="p">,</span>
        <span class="n">dafarad</span><span class="p">,</span>
        <span class="n">dfarad</span><span class="p">,</span>
        <span class="n">cfarad</span><span class="p">,</span>
        <span class="n">mfarad</span><span class="p">,</span>
        <span class="n">ufarad</span><span class="p">,</span>
        <span class="n">nfarad</span><span class="p">,</span>
        <span class="n">pfarad</span><span class="p">,</span>
        <span class="n">ffarad</span><span class="p">,</span>
        <span class="n">afarad</span><span class="p">,</span>
        <span class="n">zfarad</span><span class="p">,</span>
        <span class="n">yfarad</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># some powered units</span>
    <span class="n">powered_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmetre2</span><span class="p">,</span> <span class="n">Yfarad3</span><span class="p">]</span>

    <span class="c1"># Combined units</span>
    <span class="n">complex_units</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">kgram</span> <span class="o">*</span> <span class="n">metre2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">amp</span> <span class="o">*</span> <span class="n">second3</span><span class="p">),</span>
        <span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">kgram</span> <span class="o">*</span> <span class="n">metre2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">amp</span> <span class="o">*</span> <span class="n">second3</span><span class="p">),</span>
        <span class="n">metre</span> <span class="o">*</span> <span class="n">second</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
        <span class="mi">10</span> <span class="o">*</span> <span class="n">metre</span> <span class="o">*</span> <span class="n">second</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">kmetre</span> <span class="o">/</span> <span class="n">second</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">nS</span> <span class="o">/</span> <span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
        <span class="c1"># Made-up unit:</span>
        <span class="n">Unit</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">dim</span><span class="o">=</span><span class="n">get_or_create_dimension</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">dispname</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">,</span>
            <span class="n">latexname</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\Omega&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="mi">8000</span> <span class="o">*</span> <span class="n">umetre</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span> <span class="o">*</span> <span class="n">umetre</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="n">metre</span><span class="p">,</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">coulomb</span> <span class="o">*</span> <span class="n">metre</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">Unit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">second</span><span class="p">,</span>
        <span class="mf">3.0</span> <span class="o">*</span> <span class="n">mM</span><span class="p">,</span>
        <span class="mi">5</span> <span class="o">*</span> <span class="n">mole</span> <span class="o">/</span> <span class="n">liter</span><span class="p">,</span>
        <span class="mi">7</span> <span class="o">*</span> <span class="n">liter</span> <span class="o">/</span> <span class="n">meter3</span><span class="p">,</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="n">second</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">**-</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">(</span><span class="n">volt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">second</span><span class="p">)</span> <span class="o">/</span> <span class="n">meter</span><span class="p">,</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">second</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">unitless</span> <span class="o">=</span> <span class="p">[</span><span class="n">second</span> <span class="o">/</span> <span class="n">second</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span> <span class="o">/</span> <span class="n">second</span><span class="p">,</span> <span class="n">Unit</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
        <span class="n">units_which_should_exist</span><span class="p">,</span>
        <span class="n">some_scaled_units</span><span class="p">,</span>
        <span class="n">powered_units</span><span class="p">,</span>
        <span class="n">complex_units</span><span class="p">,</span>
        <span class="n">unitless</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimensionless</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">latex</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span> <span class="o">==</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="c1"># assert_allclose(eval(repr(u)), u)</span>

    <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]:</span>
        <span class="n">latex_str</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">latex</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">latex_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1000</span>  <span class="c1"># arbitrary threshold, but see #1425</span>

    <span class="c1"># test the `DIMENSIONLESS` object</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">DIMENSIONLESS</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
    <span class="k">assert</span> <span class="nb">repr</span><span class="p">(</span><span class="n">DIMENSIONLESS</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Dimension()&quot;</span>

    <span class="c1"># test DimensionMismatchError (only that it works without raising an error</span>
    <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">DimensionMismatchError</span><span class="p">(</span><span class="s2">&quot;A description&quot;</span><span class="p">),</span>
        <span class="n">DimensionMismatchError</span><span class="p">(</span><span class="s2">&quot;A description&quot;</span><span class="p">,</span> <span class="n">DIMENSIONLESS</span><span class="p">),</span>
        <span class="n">DimensionMismatchError</span><span class="p">(</span><span class="s2">&quot;A description&quot;</span><span class="p">,</span> <span class="n">DIMENSIONLESS</span><span class="p">,</span> <span class="n">second</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span>
    <span class="p">]:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">error</span><span class="p">))</span></div>




<div class="viewcode-block" id="test_format_quantity">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_format_quantity">[docs]</a>
<span class="k">def</span> <span class="nf">test_format_quantity</span><span class="p">():</span>
    <span class="c1"># Avoid that the default f-string (or .format call) discards units when used without</span>
    <span class="c1"># a format spec</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">ms</span>
    <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">q</span><span class="si">!s}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">q</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>




<div class="viewcode-block" id="test_slicing">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_slicing">[docs]</a>
<span class="k">def</span> <span class="nf">test_slicing</span><span class="p">():</span>
    <span class="c1"># Slicing and indexing, setting items</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">quantity</span><span class="p">[:],</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">quantity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quantity</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">quantity</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quantity</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">quantity</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quantity</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">quantity</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quantity</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span>
    <span class="n">bool_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]])</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">quantity</span><span class="p">[</span><span class="n">bool_matrix</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quantity</span><span class="p">)[</span><span class="n">bool_matrix</span><span class="p">]</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_setting">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_setting">[docs]</a>
<span class="k">def</span> <span class="nf">test_setting</span><span class="p">():</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span>
    <span class="n">quantity</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">mV</span>
    <span class="k">assert</span> <span class="n">quantity</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">mV</span>
    <span class="n">quantity</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">mV</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">quantity</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">mV</span><span class="p">)</span>
    <span class="n">quantity</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">volt</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">quantity</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span>
    <span class="c1"># Setting to zero should work without units as well</span>
    <span class="n">quantity</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">quantity</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">mV</span>

    <span class="k">def</span> <span class="nf">set_to_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">quantity</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">set_to_value</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">set_to_value</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">set_to_value</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span></div>




<div class="viewcode-block" id="test_multiplication_division">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_multiplication_division">[docs]</a>
<span class="k">def</span> <span class="nf">test_multiplication_division</span><span class="p">():</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span>

    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quantities</span><span class="p">:</span>
        <span class="c1"># Scalars and array scalars</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="n">q</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">q</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">q</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>

        <span class="c1"># (unitless) arrays</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">q</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>

        <span class="c1"># arrays with units</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">/</span> <span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">volt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">/</span> <span class="n">q2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q2</span><span class="p">),</span> <span class="n">volt</span> <span class="o">/</span> <span class="n">second</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q2</span> <span class="o">/</span> <span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">second</span> <span class="o">/</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">q2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q2</span><span class="p">),</span> <span class="n">volt</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span>

        <span class="c1"># using unsupported objects should fail</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">/</span> <span class="s2">&quot;string&quot;</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="s2">&quot;string&quot;</span> <span class="o">/</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="s2">&quot;string&quot;</span> <span class="o">*</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">*</span> <span class="s2">&quot;string&quot;</span></div>




<div class="viewcode-block" id="test_addition_subtraction">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_addition_subtraction">[docs]</a>
<span class="k">def</span> <span class="nf">test_addition_subtraction</span><span class="p">():</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">volt</span>

    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quantities</span><span class="p">:</span>
        <span class="c1"># arrays with units</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="n">q2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q2</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">q2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q2</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q2</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>

        <span class="c1"># mismatching units</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span> <span class="o">+</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span> <span class="o">-</span> <span class="n">q</span>

        <span class="c1"># scalar</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">+</span> <span class="mi">5</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="mi">5</span> <span class="o">+</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">-</span> <span class="mi">5</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="mi">5</span> <span class="o">-</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span>

        <span class="c1"># unitless array</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span> <span class="o">-</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span>

        <span class="c1"># Check that operations with 0 work</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">volt</span><span class="p">)</span>

        <span class="c1"># using unsupported objects should fail</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="s2">&quot;string&quot;</span> <span class="o">+</span> <span class="n">q</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">+</span> <span class="s2">&quot;string&quot;</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">-</span> <span class="s2">&quot;string&quot;</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="s2">&quot;string&quot;</span> <span class="o">-</span> <span class="n">q</span></div>




<div class="viewcode-block" id="test_unary_operations">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_unary_operations">[docs]</a>
<span class="k">def</span> <span class="nf">test_unary_operations</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">neg</span><span class="p">,</span> <span class="n">pos</span>

    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="n">neg</span><span class="p">,</span> <span class="n">pos</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]:</span>
            <span class="n">assert_quantity</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">),</span> <span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">kilogram</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_binary_operations">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_binary_operations">[docs]</a>
<span class="k">def</span> <span class="nf">test_binary_operations</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test whether binary operations work when they should and raise</span>
<span class="sd">    DimensionMismatchErrors when they should.</span>
<span class="sd">    Does not test for the actual result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">ge</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">le</span><span class="p">,</span> <span class="n">lt</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">sub</span>

    <span class="k">def</span> <span class="nf">assert_operations_work</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Test python builtins</span>
            <span class="n">tryops</span> <span class="o">=</span> <span class="p">[</span><span class="n">add</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">lt</span><span class="p">,</span> <span class="n">le</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">ge</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">ne</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">tryops</span><span class="p">:</span>
                <span class="n">op</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">op</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

            <span class="c1"># Test equivalent numpy functions</span>
            <span class="n">numpy_funcs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">numpy_func</span> <span class="ow">in</span> <span class="n">numpy_funcs</span><span class="p">:</span>
                <span class="n">numpy_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">numpy_func</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DimensionMismatchError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation raised unexpected exception: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">assert_operations_do_not_work</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># Test python builtins</span>
        <span class="n">tryops</span> <span class="o">=</span> <span class="p">[</span><span class="n">add</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">lt</span><span class="p">,</span> <span class="n">le</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">ge</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">ne</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">tryops</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                <span class="n">op</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                <span class="n">op</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="c1"># Test equivalent numpy functions</span>
        <span class="n">numpy_funcs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">numpy_func</span> <span class="ow">in</span> <span class="n">numpy_funcs</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                <span class="n">numpy_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                <span class="n">numpy_func</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Check that consistent units work</span>
    <span class="c1">#</span>

    <span class="c1"># unit arrays</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">kilogram</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">]:</span>
        <span class="n">assert_operations_work</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c1"># dimensionless units and scalars</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span> <span class="o">/</span> <span class="n">kilogram</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span> <span class="o">/</span> <span class="n">kilogram</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span> <span class="o">/</span> <span class="n">kilogram</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="n">assert_operations_work</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c1"># dimensionless units and unitless arrays</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span> <span class="o">/</span> <span class="n">kilogram</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span> <span class="o">/</span> <span class="n">kilogram</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span> <span class="o">/</span> <span class="n">kilogram</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="n">assert_operations_work</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Check that inconsistent units do not work</span>
    <span class="c1">#</span>

    <span class="c1"># unit arrays</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">second</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">]:</span>
        <span class="n">assert_operations_do_not_work</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c1"># unitless array</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">]:</span>
        <span class="n">assert_operations_do_not_work</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c1"># scalar</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">]:</span>
        <span class="n">assert_operations_do_not_work</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c1"># Check that comparisons with inf/-inf always work</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span> <span class="o">/</span> <span class="n">kilogram</span><span class="p">,</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">!=</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_power">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_power">[docs]</a>
<span class="k">def</span> <span class="nf">test_power</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test raising quantities to a power.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">kilogram</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">value</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">kilogram</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1"># Test raising to a dimensionless quantity</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">value</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">volt</span> <span class="o">/</span> <span class="n">volt</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">kilogram</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="c1"># FIXME: Not that if float(exponent) is a special value such as 1 or 2</span>
            <span class="c1"># numpy will actually use a ufunc such as identity or square, which will</span>
            <span class="c1"># not raise a DimensionMismatchError. This is a limitation of the current</span>
            <span class="c1"># implementation.</span>
            <span class="n">value</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mV</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span></div>




<div class="viewcode-block" id="test_inplace_operations">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_inplace_operations">[docs]</a>
<span class="k">def</span> <span class="nf">test_inplace_operations</span><span class="p">():</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">volt</span>
    <span class="n">q_orig</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">q_ref</span> <span class="o">=</span> <span class="n">q</span>

    <span class="n">q</span> <span class="o">*=</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">q_orig</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q_ref</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">/=</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q_orig</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q_ref</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">volt</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q_orig</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q_ref</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">-=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">volt</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q_orig</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q_ref</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">**=</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q_orig</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q_ref</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">**=</span> <span class="mf">0.5</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q_orig</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">q_ref</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">illegal_add</span><span class="p">(</span><span class="n">q2</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">volt</span>
        <span class="n">q</span> <span class="o">+=</span> <span class="n">q2</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">illegal_add</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">illegal_add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">illegal_sub</span><span class="p">(</span><span class="n">q2</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">volt</span>
        <span class="n">q</span> <span class="o">-=</span> <span class="n">q2</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">illegal_add</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">illegal_add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">illegal_pow</span><span class="p">(</span><span class="n">q2</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">volt</span>
        <span class="n">q</span> <span class="o">**=</span> <span class="n">q2</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">illegal_pow</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">illegal_pow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="c1"># inplace operations with unsupported objects should fail</span>
    <span class="k">for</span> <span class="n">inplace_op</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">q</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">,</span>
        <span class="n">q</span><span class="o">.</span><span class="fm">__isub__</span><span class="p">,</span>
        <span class="n">q</span><span class="o">.</span><span class="fm">__imul__</span><span class="p">,</span>
        <span class="n">q</span><span class="o">.</span><span class="fm">__itruediv__</span><span class="p">,</span>
        <span class="n">q</span><span class="o">.</span><span class="fm">__ifloordiv__</span><span class="p">,</span>
        <span class="n">q</span><span class="o">.</span><span class="fm">__imod__</span><span class="p">,</span>
        <span class="n">q</span><span class="o">.</span><span class="fm">__ipow__</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">inplace_op</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
            <span class="c1"># if it doesn&#39;t fail with an error, it should return NotImplemented</span>
            <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="bp">NotImplemented</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># raised on numpy &gt;= 0.10</span>

    <span class="c1"># make sure that inplace operations do not work on units/dimensions at all</span>
    <span class="k">for</span> <span class="n">inplace_op</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">volt</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">.</span><span class="fm">__isub__</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">.</span><span class="fm">__imul__</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">.</span><span class="fm">__itruediv__</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">.</span><span class="fm">__ifloordiv__</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">.</span><span class="fm">__imod__</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">.</span><span class="fm">__ipow__</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">inplace_op</span><span class="p">(</span><span class="n">volt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">inplace_op</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">volt</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="fm">__imul__</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="fm">__itruediv__</span><span class="p">,</span>
        <span class="n">volt</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="fm">__ipow__</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">inplace_op</span><span class="p">(</span><span class="n">volt</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_unit_discarding_functions">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_unit_discarding_functions">[docs]</a>
<span class="k">def</span> <span class="nf">test_unit_discarding_functions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test functions that discard units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">unitSI.unitsafefunctions</span> <span class="kn">import</span> <span class="n">ones_like</span><span class="p">,</span> <span class="n">zeros_like</span>

    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">ones_like</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="c1"># Calling non-zero on a 0d array is deprecated, don&#39;t test it:</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">assert_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span></div>




<div class="viewcode-block" id="test_unitsafe_functions">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_unitsafe_functions">[docs]</a>
<span class="k">def</span> <span class="nf">test_unitsafe_functions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the unitsafe functions wrapping their numpy counterparts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">unitSI.unitsafefunctions</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">arccos</span><span class="p">,</span>
        <span class="n">arccosh</span><span class="p">,</span>
        <span class="n">arcsin</span><span class="p">,</span>
        <span class="n">arcsinh</span><span class="p">,</span>
        <span class="n">arctan</span><span class="p">,</span>
        <span class="n">arctanh</span><span class="p">,</span>
        <span class="n">cos</span><span class="p">,</span>
        <span class="n">cosh</span><span class="p">,</span>
        <span class="n">exp</span><span class="p">,</span>
        <span class="n">log</span><span class="p">,</span>
        <span class="n">sin</span><span class="p">,</span>
        <span class="n">sinh</span><span class="p">,</span>
        <span class="n">tan</span><span class="p">,</span>
        <span class="n">tanh</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># All functions with their numpy counterparts</span>
    <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">),</span>
        <span class="p">(</span><span class="n">sinh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">),</span>
        <span class="p">(</span><span class="n">arcsin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">),</span>
        <span class="p">(</span><span class="n">arcsinh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">),</span>
        <span class="p">(</span><span class="n">cos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">),</span>
        <span class="p">(</span><span class="n">cosh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">),</span>
        <span class="p">(</span><span class="n">arccos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">),</span>
        <span class="p">(</span><span class="n">arccosh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arccosh</span><span class="p">),</span>
        <span class="p">(</span><span class="n">tan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">),</span>
        <span class="p">(</span><span class="n">tanh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">),</span>
        <span class="p">(</span><span class="n">arctan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">),</span>
        <span class="p">(</span><span class="n">arctanh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">),</span>
        <span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">),</span>
        <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">unitless_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">numpy_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))]</span>
    <span class="n">unit_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">np_func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
        <span class="c1"># make sure these functions raise errors when run on values with dimensions</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unit_values</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                <span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># make sure the functions are equivalent to their numpy counterparts</span>
        <span class="c1"># when run on unitless values while ignoring warnings about invalid</span>
        <span class="c1"># values or divisions by zero</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unitless_values</span><span class="p">:</span>
                <span class="n">assert_equal</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">np_func</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">numpy_values</span><span class="p">:</span>
                <span class="n">assert_equal</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">np_func</span><span class="p">(</span><span class="n">val</span><span class="p">))</span></div>




<div class="viewcode-block" id="test_special_case_numpy_functions">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_special_case_numpy_functions">[docs]</a>
<span class="k">def</span> <span class="nf">test_special_case_numpy_functions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test a couple of functions/methods that need special treatment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">unitSI.unitsafefunctions</span> <span class="kn">import</span> <span class="n">diagonal</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">ravel</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">where</span>

    <span class="n">quadratic_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span>

    <span class="c1"># Temporarily suppress warnings related to the matplotlib 1.3 bug</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="c1"># Check that function and method do the same thing</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">),</span> <span class="n">quadratic_matrix</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="c1"># Check that function gives the same result as on unitless arrays</span>
        <span class="n">assert_equal</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span> <span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="c1"># Check that the function gives the same results as the original numpy</span>
        <span class="c1"># function</span>
        <span class="n">assert_equal</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span> <span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="c1"># Do the same checks for diagonal, trace and dot</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">diagonal</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">),</span> <span class="n">quadratic_matrix</span><span class="o">.</span><span class="n">diagonal</span><span class="p">())</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">diagonal</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span> <span class="n">diagonal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span>
        <span class="n">diagonal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">assert_equal</span><span class="p">(</span><span class="n">trace</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">),</span> <span class="n">quadratic_matrix</span><span class="o">.</span><span class="n">trace</span><span class="p">())</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">trace</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span> <span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span> <span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">dot</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">,</span> <span class="n">quadratic_matrix</span><span class="p">),</span> <span class="n">quadratic_matrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">,</span> <span class="n">quadratic_matrix</span><span class="p">)),</span>
        <span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span>
        <span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="o">.</span><span class="n">prod</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Check for correct units</span>
    <span class="k">if</span> <span class="n">use_matplotlib_units_fix</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ravel</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">,</span> <span class="n">ravel</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">,</span> <span class="n">trace</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">,</span> <span class="n">diagonal</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span>
        <span class="n">quadratic_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">quadratic_matrix</span><span class="p">,</span> <span class="n">quadratic_matrix</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span>
        <span class="n">quadratic_matrix</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">quadratic_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="n">quadratic_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># check the where function</span>
    <span class="c1"># pure numpy array</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
    <span class="n">ar1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">ar2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">),</span> <span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span><span class="p">),</span> <span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span><span class="p">))</span>

    <span class="c1"># dimensionless quantity</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">ar1</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">,</span> <span class="n">ar2</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1"># quantity with dimensions</span>
    <span class="n">ar1</span> <span class="o">=</span> <span class="n">ar1</span> <span class="o">*</span> <span class="n">mV</span>
    <span class="n">ar2</span> <span class="o">=</span> <span class="n">ar2</span> <span class="o">*</span> <span class="n">mV</span>
    <span class="n">assert_equal</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ar1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ar2</span><span class="p">)),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># Check some error cases</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">ar1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar2</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">ar1</span><span class="p">,</span> <span class="n">ar1</span> <span class="o">/</span> <span class="n">ms</span><span class="p">)</span>

    <span class="c1"># Check setasflat (for numpy &lt; 1.7)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Quantity</span><span class="p">,</span> <span class="s2">&quot;setasflat&quot;</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">volt</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">second</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">setasflat</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">setasflat</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

    <span class="c1"># Check cumprod</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span></div>



<span class="c1"># Functions that should not change units</span>

<div class="viewcode-block" id="test_numpy_functions_same_dimensions">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_numpy_functions_same_dimensions">[docs]</a>
<span class="k">def</span> <span class="nf">test_numpy_functions_same_dimensions</span><span class="p">():</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))]</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">volt</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">siemens</span><span class="p">,</span> <span class="n">mV</span><span class="p">,</span> <span class="n">kHz</span><span class="p">]</span>

    <span class="kn">from</span> <span class="nn">unitSI.unitsafefunctions</span> <span class="kn">import</span> <span class="n">ptp</span>

    <span class="c1"># numpy functions</span>
    <span class="n">keep_dim_funcs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">negative</span><span class="p">,</span>
        <span class="n">ptp</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
        <span class="n">q_ar</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">unit</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">keep_dim_funcs</span><span class="p">:</span>
            <span class="n">test_ar</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">q_ar</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">test_ar</span><span class="p">)</span> <span class="ow">is</span> <span class="n">q_ar</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; failed on </span><span class="si">{</span><span class="n">q_ar</span><span class="si">!r}</span><span class="s2"> -- dim was &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">q_ar</span><span class="o">.</span><span class="n">dim</span><span class="si">}</span><span class="s2">, is now </span><span class="si">{</span><span class="n">get_dimensions</span><span class="p">(</span><span class="n">test_ar</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

                <span class="c1"># Python builtins should work on one-dimensional arrays</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">builtins</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">sum</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
                    <span class="n">q_ar</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">unit</span>
                <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">builtins</span><span class="p">:</span>
                    <span class="n">test_ar</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">q_ar</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">test_ar</span><span class="p">)</span> <span class="ow">is</span> <span class="n">q_ar</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; failed on </span><span class="si">{</span><span class="n">q_ar</span><span class="si">!r}</span><span class="s2"> -- dim &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;was </span><span class="si">{</span><span class="n">q_ar</span><span class="o">.</span><span class="n">dim</span><span class="si">}</span><span class="s2">, is now &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_dimensions</span><span class="p">(</span><span class="n">test_ar</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span></div>




<div class="viewcode-block" id="test_numpy_functions_indices">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_numpy_functions_indices">[docs]</a>
<span class="k">def</span> <span class="nf">test_numpy_functions_indices</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check numpy functions that return indices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">17</span><span class="p">])]</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">volt</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">siemens</span><span class="p">,</span> <span class="n">mV</span><span class="p">,</span> <span class="n">kHz</span><span class="p">]</span>

    <span class="c1"># numpy functions</span>
    <span class="n">keep_dim_funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
        <span class="n">q_ar</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">unit</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">keep_dim_funcs</span><span class="p">:</span>
            <span class="n">test_ar</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">q_ar</span><span class="p">)</span>
            <span class="c1"># Compare it to the result on the same value without units</span>
            <span class="n">comparison_ar</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">assert_equal</span><span class="p">(</span>
                <span class="n">test_ar</span><span class="p">,</span>
                <span class="n">comparison_ar</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="s2">&quot;function </span><span class="si">%s</span><span class="s2"> returned an incorrect result when used on quantities &quot;</span>
                    <span class="o">%</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">),</span>
            <span class="p">)</span></div>




<div class="viewcode-block" id="test_numpy_functions_dimensionless">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_numpy_functions_dimensionless">[docs]</a>
<span class="k">def</span> <span class="nf">test_numpy_functions_dimensionless</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that numpy functions that should work on dimensionless quantities only</span>
<span class="sd">    work dimensionless arrays and return the correct result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unitless_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))]</span>
    <span class="n">unit_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="c1"># ignore division by 0 warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">unitless_values</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ufunc</span> <span class="ow">in</span> <span class="n">UFUNCS_DIMENSIONLESS</span><span class="p">:</span>
                <span class="n">result_unitless</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value)&quot;</span><span class="p">)</span>
                <span class="n">result_array</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(np.array(value))&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">result_unitless</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_unitless</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span>
                <span class="n">assert_equal</span><span class="p">(</span><span class="n">result_unitless</span><span class="p">,</span> <span class="n">result_array</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ufunc</span> <span class="ow">in</span> <span class="n">UFUNCS_DIMENSIONLESS_TWOARGS</span><span class="p">:</span>
                <span class="n">result_unitless</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value, value)&quot;</span><span class="p">)</span>
                <span class="n">result_array</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(np.array(value), np.array(value))&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">result_unitless</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_unitless</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span>
                <span class="n">assert_equal</span><span class="p">(</span><span class="n">result_unitless</span><span class="p">,</span> <span class="n">result_array</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">unitless_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unit_values</span><span class="p">,</span> <span class="n">unitless_values</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ufunc</span> <span class="ow">in</span> <span class="n">UFUNCS_DIMENSIONLESS</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value)&quot;</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">ufunc</span> <span class="ow">in</span> <span class="n">UFUNCS_DIMENSIONLESS_TWOARGS</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                    <span class="nb">eval</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value1, value2)&quot;</span><span class="p">,</span>
                        <span class="nb">globals</span><span class="p">(),</span>
                        <span class="p">{</span><span class="s2">&quot;value1&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;value2&quot;</span><span class="p">:</span> <span class="n">unitless_value</span><span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                    <span class="nb">eval</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value2, value1)&quot;</span><span class="p">,</span>
                        <span class="nb">globals</span><span class="p">(),</span>
                        <span class="p">{</span><span class="s2">&quot;value1&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;value2&quot;</span><span class="p">:</span> <span class="n">unitless_value</span><span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value, value)&quot;</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span></div>




<div class="viewcode-block" id="test_numpy_functions_change_dimensions">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_numpy_functions_change_dimensions">[docs]</a>
<span class="k">def</span> <span class="nf">test_numpy_functions_change_dimensions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test some numpy functions that change the dimensions of the quantity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">unit_values</span><span class="p">:</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)),</span> <span class="n">volt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)),</span> <span class="n">volt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)),</span> <span class="n">volt</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">assert_quantity</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)),</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">volt</span>
        <span class="p">)</span></div>




<span class="c1"># def test_numpy_functions_matmul():</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Check support for matmul and the ``@`` operator.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     no_units_eye = np.eye(3)</span>
<span class="c1">#     with_units_eye = no_units_eye * Mohm</span>
<span class="c1">#     matrix_no_units = np.arange(9).reshape((3, 3))</span>
<span class="c1">#     matrix_units = matrix_no_units * nA</span>

<span class="c1">#     # First operand with units</span>
<span class="c1">#     assert_allclose(no_units_eye @ matrix_units, matrix_units)</span>
<span class="c1">#     assert have_same_dimensions(no_units_eye @ matrix_units, matrix_units)</span>
<span class="c1">#     assert_allclose(np.matmul(no_units_eye, matrix_units), matrix_units)</span>
<span class="c1">#     assert have_same_dimensions(np.matmul(no_units_eye, matrix_units), matrix_units)</span>

<span class="c1">#     # Second operand with units</span>
<span class="c1">#     assert_allclose(with_units_eye @ matrix_no_units, matrix_no_units * Mohm)</span>
<span class="c1">#     assert have_same_dimensions(</span>
<span class="c1">#         with_units_eye @ matrix_no_units, matrix_no_units * Mohm</span>
<span class="c1">#     )</span>
<span class="c1">#     assert_allclose(np.matmul(with_units_eye, matrix_no_units), matrix_no_units * Mohm)</span>
<span class="c1">#     assert have_same_dimensions(</span>
<span class="c1">#         np.matmul(with_units_eye, matrix_no_units), matrix_no_units * Mohm</span>
<span class="c1">#     )</span>

<span class="c1">#     # Both operands with units</span>
<span class="c1">#     assert_allclose(</span>
<span class="c1">#         with_units_eye @ matrix_units, no_units_eye @ matrix_no_units * nA * Mohm</span>
<span class="c1">#     )</span>
<span class="c1">#     assert have_same_dimensions(with_units_eye @ matrix_units, nA * Mohm)</span>
<span class="c1">#     assert_allclose(</span>
<span class="c1">#         np.matmul(with_units_eye, matrix_units),</span>
<span class="c1">#         np.matmul(no_units_eye, matrix_no_units) * nA * Mohm,</span>
<span class="c1">#     )</span>
<span class="c1">#     assert have_same_dimensions(np.matmul(with_units_eye, matrix_units), nA * Mohm)</span>



<div class="viewcode-block" id="test_numpy_functions_typeerror">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_numpy_functions_typeerror">[docs]</a>
<span class="k">def</span> <span class="nf">test_numpy_functions_typeerror</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assures that certain numpy functions raise a TypeError when called on</span>
<span class="sd">    quantities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unitless_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">unit_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">unitless_values</span> <span class="o">+</span> <span class="n">unit_values</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ufunc</span> <span class="ow">in</span> <span class="n">UFUNCS_INTEGERS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ufunc</span> <span class="o">==</span> <span class="s2">&quot;invert&quot;</span><span class="p">:</span>
                <span class="c1"># only takes one argument</span>
                <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value)&quot;</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value, value)&quot;</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span></div>




<div class="viewcode-block" id="test_numpy_functions_logical">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_numpy_functions_logical">[docs]</a>
<span class="k">def</span> <span class="nf">test_numpy_functions_logical</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assure that logical numpy functions work on all quantities and return</span>
<span class="sd">    unitless boolean arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit_values1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>
    <span class="n">unit_values2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">second</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">second</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">second</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ufunc</span> <span class="ow">in</span> <span class="n">UFUNCS_LOGICAL</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">value1</span><span class="p">,</span> <span class="n">value2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unit_values1</span><span class="p">,</span> <span class="n">unit_values2</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># one argument</span>
                <span class="n">result_units</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value1)&quot;</span><span class="p">)</span>
                <span class="n">result_array</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(np.array(value1))&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="c1"># two arguments</span>
                <span class="n">result_units</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(value1, value2)&quot;</span><span class="p">)</span>
                <span class="n">result_array</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.</span><span class="si">{</span><span class="n">ufunc</span><span class="si">}</span><span class="s2">(np.array(value1), np.array(value2))&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_units</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span>
            <span class="n">assert_equal</span><span class="p">(</span><span class="n">result_units</span><span class="p">,</span> <span class="n">result_array</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_arange_linspace">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_arange_linspace">[docs]</a>
<span class="k">def</span> <span class="nf">test_arange_linspace</span><span class="p">():</span>
    <span class="c1"># For dimensionless values, the unit-safe functions should give the same results</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Make sure units are checked</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">mV</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">mV</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">ms</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ms</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ms</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">mV</span><span class="p">)</span>

    <span class="c1"># Check correct functioning with units</span>
    <span class="n">assert_quantity</span><span class="p">(</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">mV</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">mV</span>
    <span class="p">)</span>
    <span class="n">assert_quantity</span><span class="p">(</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">mV</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">mV</span>
    <span class="p">)</span>
    <span class="n">assert_quantity</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mV</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">mV</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">mV</span><span class="p">)</span>

    <span class="c1"># Check errors for arange with incorrect numbers of arguments/duplicate arguments</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_list">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_list">[docs]</a>
<span class="k">def</span> <span class="nf">test_list</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test converting to and from a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">from_list</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">from_list</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">from_list</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_check_units">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_check_units">[docs]</a>
<span class="k">def</span> <span class="nf">test_check_units</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the check_units decorator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@check_units</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">volt</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">a_function</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        v has to have units of volt, x can have any (or no) unit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="c1"># Try correct units</span>
    <span class="n">a_function</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">a_function</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">volt</span><span class="p">,</span> <span class="s2">&quot;something&quot;</span><span class="p">)</span>
    <span class="n">a_function</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">volt</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># lists that can be converted should also work</span>
    <span class="n">a_function</span><span class="p">([</span><span class="mi">1</span> <span class="o">*</span> <span class="n">volt</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">volt</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">volt</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Strings and None are also allowed to pass</span>
    <span class="n">a_function</span><span class="p">(</span><span class="s2">&quot;a string&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">a_function</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Try incorrect units</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">a_function</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">second</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">a_function</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">a_function</span><span class="p">(</span><span class="nb">object</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">a_function</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">volt</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@check_units</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">second</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">b_function</span><span class="p">(</span><span class="n">return_second</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a value in seconds if return_second is True, otherwise return</span>
<span class="sd">        a value in volt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">return_second</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">volt</span>

    <span class="c1"># Should work (returns second)</span>
    <span class="n">b_function</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Should fail (returns volt)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">b_function</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@check_units</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">c_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span>

    <span class="k">assert</span> <span class="n">c_function</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">c_function</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">c_function</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">c_function</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">c_function</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_get_unit">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_get_unit">[docs]</a>
<span class="k">def</span> <span class="nf">test_get_unit</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test get_unit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">volt</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">volt</span><span class="p">),</span>
        <span class="p">(</span><span class="n">mV</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">volt</span><span class="p">),</span>
        <span class="p">((</span><span class="n">amp</span> <span class="o">/</span> <span class="n">metre</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">amp</span> <span class="o">/</span> <span class="n">metre</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">expected_unit</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">get_unit</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">unit</span> <span class="o">==</span> <span class="n">expected_unit</span>
        <span class="k">assert</span> <span class="nb">float</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span></div>




<div class="viewcode-block" id="test_get_best_unit">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_get_best_unit">[docs]</a>
<span class="k">def</span> <span class="nf">test_get_best_unit</span><span class="p">():</span>
    <span class="c1"># get_best_unit should not check all values for long arrays, since it is</span>
    <span class="c1"># a function used for display purposes only. Instead, only the first and</span>
    <span class="c1"># last few values should matter (see github issue #966)</span>
    <span class="n">long_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span> <span class="o">*</span> <span class="n">siemens</span>
    <span class="n">long_ar</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">nS</span>
    <span class="n">long_ar</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nS</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="n">mV</span><span class="p">),</span>
        <span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">]</span> <span class="o">*</span> <span class="n">second</span><span class="p">,</span> <span class="n">ms</span><span class="p">),</span>
        <span class="p">(</span><span class="n">long_ar</span><span class="p">,</span> <span class="n">nS</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">ar</span><span class="p">,</span> <span class="n">expected_unit</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">ar</span><span class="o">.</span><span class="n">get_best_unit</span><span class="p">()</span> <span class="ow">is</span> <span class="n">expected_unit</span>
        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">expected_unit</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">in_best_unit</span><span class="p">()</span></div>




<div class="viewcode-block" id="test_switching_off_unit_checks">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_switching_off_unit_checks">[docs]</a>
<span class="k">def</span> <span class="nf">test_switching_off_unit_checks</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check switching off unit checks (used for external functions).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">unitSI.fundamentalunits</span> <span class="k">as</span> <span class="nn">fundamentalunits</span>

    <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">second</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">volt</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="n">fundamentalunits</span><span class="o">.</span><span class="n">unit_checking</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Now it should work</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">has_same_dimensions</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">fundamentalunits</span><span class="o">.</span><span class="n">unit_checking</span> <span class="o">=</span> <span class="kc">True</span></div>




<div class="viewcode-block" id="test_fail_for_dimension_mismatch">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_fail_for_dimension_mismatch">[docs]</a>
<span class="k">def</span> <span class="nf">test_fail_for_dimension_mismatch</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the fail_for_dimension_mismatch function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># examples that should not raise an error</span>
    <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span> <span class="o">=</span> <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">dim1</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">dim2</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span> <span class="o">=</span> <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">volt</span> <span class="o">/</span> <span class="n">volt</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">dim1</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">dim2</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span> <span class="o">=</span> <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">volt</span> <span class="o">/</span> <span class="n">volt</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">dim1</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">assert</span> <span class="n">dim2</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span>
    <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span> <span class="o">=</span> <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">volt</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">dim1</span> <span class="ow">is</span> <span class="n">volt</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">dim2</span> <span class="ow">is</span> <span class="n">volt</span><span class="o">.</span><span class="n">dim</span>

    <span class="c1"># examples that should raise an error</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">volt</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DimensionMismatchError</span><span class="p">):</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">volt</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">second</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_deepcopy">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_deepcopy">[docs]</a>
<span class="k">def</span> <span class="nf">test_deepcopy</span><span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">second</span><span class="p">}</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

    <span class="n">d_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d_copy</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">second</span>
    <span class="n">d_copy</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">second</span>
    <span class="k">assert</span> <span class="n">d_copy</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">second</span>
    <span class="k">assert</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">second</span></div>




<div class="viewcode-block" id="test_inplace_on_scalars">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_inplace_on_scalars">[docs]</a>
<span class="k">def</span> <span class="nf">test_inplace_on_scalars</span><span class="p">():</span>
    <span class="c1"># We want &quot;copy semantics&quot; for in-place operations on scalar quantities</span>
    <span class="c1"># in the same way as for Python scalars</span>
    <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">]:</span>
        <span class="n">scalar_reference</span> <span class="o">=</span> <span class="n">scalar</span>
        <span class="n">scalar_copy</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scalar</span> <span class="o">+=</span> <span class="n">scalar_copy</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">scalar_copy</span><span class="p">,</span> <span class="n">scalar_reference</span><span class="p">)</span>
        <span class="n">scalar</span> <span class="o">*=</span> <span class="mf">1.5</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">scalar_copy</span><span class="p">,</span> <span class="n">scalar_reference</span><span class="p">)</span>
        <span class="n">scalar</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">scalar_copy</span><span class="p">,</span> <span class="n">scalar_reference</span><span class="p">)</span>

        <span class="c1"># also check that it worked correctly for the scalar itself</span>
        <span class="c1"># assert_allclose(scalar, (scalar_copy + scalar_copy) * 1.5 / 2)</span>

    <span class="c1"># For arrays, it should use reference semantics</span>
    <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="p">[[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">mV</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">mV</span> <span class="o">/</span> <span class="n">mV</span><span class="p">]:</span>
        <span class="n">vector_reference</span> <span class="o">=</span> <span class="n">vector</span>
        <span class="n">vector_copy</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">vector</span> <span class="o">+=</span> <span class="n">vector_copy</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">vector_reference</span><span class="p">)</span>
        <span class="n">vector</span> <span class="o">*=</span> <span class="mf">1.5</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">vector_reference</span><span class="p">)</span>
        <span class="n">vector</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="n">assert_equal</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">vector_reference</span><span class="p">)</span></div>


        <span class="c1"># also check that it worked correctly for the vector itself</span>
        <span class="c1"># assert_allclose(vector, (vector_copy + vector_copy) * 1.5 / 2)</span>


<div class="viewcode-block" id="test_units_vs_quantities">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_units_vs_quantities">[docs]</a>
<span class="k">def</span> <span class="nf">test_units_vs_quantities</span><span class="p">():</span>
    <span class="c1"># Unit objects should stay Unit objects under certain operations</span>
    <span class="c1"># (important e.g. in the unit definition of Equations, where only units but</span>
    <span class="c1"># not quantities are allowed)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meter</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meter</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meter</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meter</span> <span class="o">/</span> <span class="n">second</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amp</span> <span class="o">/</span> <span class="n">meter</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">meter</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">meter</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span>

    <span class="c1"># Using the unconventional type(x) == y since we want to test that</span>
    <span class="c1"># e.g. meter**2 stays a Unit and does not become a Quantity however Unit</span>
    <span class="c1"># inherits from Quantity and therefore both would pass the isinstance test</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">meter</span><span class="p">)</span> <span class="o">==</span> <span class="n">Quantity</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">meter</span><span class="p">)</span> <span class="o">==</span> <span class="n">Quantity</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">meter</span> <span class="o">+</span> <span class="n">meter</span><span class="p">)</span> <span class="o">==</span> <span class="n">Quantity</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">meter</span> <span class="o">-</span> <span class="n">meter</span><span class="p">)</span> <span class="o">==</span> <span class="n">Quantity</span></div>




<div class="viewcode-block" id="test_all_units_list">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_all_units_list">[docs]</a>
<span class="k">def</span> <span class="nf">test_all_units_list</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">unitSI.allunits</span> <span class="kn">import</span> <span class="n">all_units</span>

    <span class="k">assert</span> <span class="n">meter</span> <span class="ow">in</span> <span class="n">all_units</span>
    <span class="k">assert</span> <span class="n">volt</span> <span class="ow">in</span> <span class="n">all_units</span>
    <span class="k">assert</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">all_units</span>
    <span class="k">assert</span> <span class="n">Hz</span> <span class="ow">in</span> <span class="n">all_units</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">all_units</span><span class="p">)</span></div>




<div class="viewcode-block" id="test_constants">
<a class="viewcode-back" href="../../../unitSI.tests.test_units.html#unitSI.tests.test_units.test_constants">[docs]</a>
<span class="k">def</span> <span class="nf">test_constants</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">unitSI.constants</span> <span class="k">as</span> <span class="nn">constants</span>

    <span class="c1"># Check that the expected names exist and have the correct dimensions</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">avogadro_constant</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">mole</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">boltzmann_constant</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="p">(</span><span class="n">joule</span> <span class="o">/</span> <span class="n">kelvin</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">electric_constant</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="p">(</span><span class="n">farad</span> <span class="o">/</span> <span class="n">meter</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">electron_mass</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="n">kilogram</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">elementary_charge</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="n">coulomb</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">faraday_constant</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="p">(</span><span class="n">coulomb</span> <span class="o">/</span> <span class="n">mole</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">gas_constant</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="p">(</span><span class="n">joule</span> <span class="o">/</span> <span class="n">mole</span> <span class="o">/</span> <span class="n">kelvin</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">magnetic_constant</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="p">(</span><span class="n">newton</span> <span class="o">/</span> <span class="n">amp2</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">molar_mass_constant</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="p">(</span><span class="n">kilogram</span> <span class="o">/</span> <span class="n">mole</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">assert</span> <span class="n">constants</span><span class="o">.</span><span class="n">zero_celsius</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="n">kelvin</span><span class="o">.</span><span class="n">dim</span></div>


    <span class="c1"># Check the consistency between a few constants</span>
    <span class="c1"># assert_allclose(</span>
    <span class="c1">#     constants.gas_constant,</span>
    <span class="c1">#     constants.avogadro_constant * constants.boltzmann_constant,</span>
    <span class="c1"># )</span>
    <span class="c1"># assert_allclose(</span>
    <span class="c1">#     constants.faraday_constant,</span>
    <span class="c1">#     constants.avogadro_constant * constants.elementary_charge,</span>
    <span class="c1"># )</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_construction</span><span class="p">()</span>
    <span class="n">test_get_dimensions</span><span class="p">()</span>
    <span class="n">test_display</span><span class="p">()</span>
    <span class="n">test_scale</span><span class="p">()</span>
    <span class="n">test_power</span><span class="p">()</span>
    <span class="n">test_pickling</span><span class="p">()</span>
    <span class="n">test_str_repr</span><span class="p">()</span>
    <span class="n">test_slicing</span><span class="p">()</span>
    <span class="n">test_setting</span><span class="p">()</span>
    <span class="n">test_multiplication_division</span><span class="p">()</span>
    <span class="n">test_addition_subtraction</span><span class="p">()</span>
    <span class="n">test_unary_operations</span><span class="p">()</span>
    <span class="n">test_binary_operations</span><span class="p">()</span>
    <span class="n">test_inplace_operations</span><span class="p">()</span>
    <span class="n">test_unit_discarding_functions</span><span class="p">()</span>
    <span class="n">test_unitsafe_functions</span><span class="p">()</span>
    <span class="n">test_special_case_numpy_functions</span><span class="p">()</span>
    <span class="n">test_numpy_functions_same_dimensions</span><span class="p">()</span>
    <span class="n">test_numpy_functions_indices</span><span class="p">()</span>
    <span class="n">test_numpy_functions_dimensionless</span><span class="p">()</span>
    <span class="n">test_numpy_functions_change_dimensions</span><span class="p">()</span>
    <span class="n">test_numpy_functions_typeerror</span><span class="p">()</span>
    <span class="n">test_numpy_functions_logical</span><span class="p">()</span>
    <span class="n">test_arange_linspace</span><span class="p">()</span>
    <span class="n">test_list</span><span class="p">()</span>
    <span class="n">test_check_units</span><span class="p">()</span>
    <span class="n">test_get_unit</span><span class="p">()</span>
    <span class="n">test_get_best_unit</span><span class="p">()</span>
    <span class="n">test_switching_off_unit_checks</span><span class="p">()</span>
    <span class="n">test_fail_for_dimension_mismatch</span><span class="p">()</span>
    <span class="n">test_deepcopy</span><span class="p">()</span>
    <span class="n">test_inplace_on_scalars</span><span class="p">()</span>
    <span class="n">test_units_vs_quantities</span><span class="p">()</span>
    <span class="n">test_all_units_list</span><span class="p">()</span>
    <span class="n">test_constants</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">unitSI</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">unitSI</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Sorin Birchi.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>