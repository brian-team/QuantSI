<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>unitSI.fundamentalunits &#8212; unitSI v1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=e160b93e"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for unitSI.fundamentalunits</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines physical units and quantities</span>

<span class="sd">=====================  ========  ======</span>
<span class="sd">Quantity               Unit      Symbol</span>
<span class="sd">---------------------  --------  ------</span>
<span class="sd">Length                 metre     m</span>
<span class="sd">Mass                   kilogram  kg</span>
<span class="sd">Time                   second    s</span>
<span class="sd">Electric current       ampere    A</span>
<span class="sd">Temperature            kelvin    K</span>
<span class="sd">Quantity of substance  mole      mol</span>
<span class="sd">Luminosity             candle    cd</span>
<span class="sd">=====================  ========  ======</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">numpy.exceptions</span> <span class="kn">import</span> <span class="n">VisibleDeprecationWarning</span>  <span class="c1"># numpy 2.x</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">VisibleDeprecationWarning</span>  <span class="c1"># numpy 1.x</span>

<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">latex</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;DimensionMismatchError&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_or_create_dimension&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_dimensions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_dimensionless&quot;</span><span class="p">,</span>
    <span class="s2">&quot;have_same_dimensions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;in_unit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;in_best_unit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Quantity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Unit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;register_new_unit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;check_units&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_scalar_type&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_unit&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">unit_checking</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_flatten</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flatten a given list `iterable`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">yield from</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">e</span>


<span class="k">def</span> <span class="nf">_short_str</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a short string representation of an array, suitable for use in</span>
<span class="sd">    error messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">old_printoptions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">get_printoptions</span><span class="p">()</span>
    <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">edgeitems</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">arr_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="o">**</span><span class="n">old_printoptions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr_string</span>


<span class="c1"># ===============================================================================</span>
<span class="c1"># Numpy ufuncs</span>
<span class="c1"># ===============================================================================</span>

<span class="c1"># Note: A list of numpy ufuncs can be found here:</span>
<span class="c1"># http://docs.scipy.org/doc/numpy/reference/ufuncs.html#available-ufuncs</span>

<span class="c1">#: ufuncs that work on all dimensions and preserve the dimensions, e.g. abs</span>
<span class="n">UFUNCS_PRESERVE_DIMENSIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;absolute&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rint&quot;</span><span class="p">,</span>
    <span class="s2">&quot;negative&quot;</span><span class="p">,</span>
    <span class="s2">&quot;positive&quot;</span><span class="p">,</span>
    <span class="s2">&quot;conj&quot;</span><span class="p">,</span>
    <span class="s2">&quot;conjugate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;floor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ceil&quot;</span><span class="p">,</span>
    <span class="s2">&quot;trunc&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1">#: ufuncs that work on all dimensions but change the dimensions, e.g. square</span>
<span class="n">UFUNCS_CHANGE_DIMENSIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;multiply&quot;</span><span class="p">,</span>
    <span class="s2">&quot;divide&quot;</span><span class="p">,</span>
    <span class="s2">&quot;true_divide&quot;</span><span class="p">,</span>
    <span class="s2">&quot;floor_divide&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sqrt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;square&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reciprocal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;matmul&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1">#: ufuncs that work with matching dimensions, e.g. add</span>
<span class="n">UFUNCS_MATCHING_DIMENSIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;add&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subtract&quot;</span><span class="p">,</span>
    <span class="s2">&quot;maximum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;minimum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;remainder&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mod&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fmod&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1">#: ufuncs that compare values, i.e. work only with matching dimensions but do</span>
<span class="c1">#: not result in a value with dimensions, e.g. equals</span>
<span class="n">UFUNCS_COMPARISONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;less&quot;</span><span class="p">,</span>
    <span class="s2">&quot;less_equal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;greater&quot;</span><span class="p">,</span>
    <span class="s2">&quot;greater_equal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;equal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;not_equal&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1">#: Logical operations that work on all quantities and return boolean arrays</span>
<span class="n">UFUNCS_LOGICAL</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;logical_and&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logical_or&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logical_xor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logical_not&quot;</span><span class="p">,</span>
    <span class="s2">&quot;isreal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iscomplex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;isfinite&quot;</span><span class="p">,</span>
    <span class="s2">&quot;isinf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;isnan&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1">#: ufuncs that only work on dimensionless quantities</span>
<span class="n">UFUNCS_DIMENSIONLESS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;sin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sinh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arcsin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arcsinh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cos&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cosh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arccos&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arccosh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tanh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arctan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arctanh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;log2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;log10&quot;</span><span class="p">,</span>
    <span class="s2">&quot;log1p&quot;</span><span class="p">,</span>
    <span class="s2">&quot;exp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;exp2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;expm1&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1">#: ufuncs that only work on two dimensionless quantities</span>
<span class="n">UFUNCS_DIMENSIONLESS_TWOARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;logaddexp&quot;</span><span class="p">,</span> <span class="s2">&quot;logaddexp2&quot;</span><span class="p">,</span> <span class="s2">&quot;arctan2&quot;</span><span class="p">,</span> <span class="s2">&quot;hypot&quot;</span><span class="p">]</span>

<span class="c1">#: ufuncs that only work on integers and therefore never on quantities</span>
<span class="n">UFUNCS_INTEGERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;bitwise_and&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bitwise_or&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bitwise_xor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;invert&quot;</span><span class="p">,</span>
    <span class="s2">&quot;left_shift&quot;</span><span class="p">,</span>
    <span class="s2">&quot;right_shift&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Utility functions</span>
<span class="c1"># ==============================================================================</span>


<span class="k">def</span> <span class="nf">fail_for_dimension_mismatch</span><span class="p">(</span>
    <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">error_quantities</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare the dimensions of two objects.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj1, obj2 : {array-like, `Quantity`}</span>
<span class="sd">        The object to compare. If `obj2` is ``None``, assume it to be</span>
<span class="sd">        dimensionless</span>
<span class="sd">    error_message : str, optional</span>
<span class="sd">        An error message that is used in the DimensionMismatchError</span>
<span class="sd">    error_quantities : dict mapping str to `Quantity`, optional</span>
<span class="sd">        Quantities in this dictionary will be converted using the `_short_str`</span>
<span class="sd">        helper method and inserted into the ``error_message`` (which should</span>
<span class="sd">        have placeholders with the corresponding names). The reason for doing</span>
<span class="sd">        this in a somewhat complicated way instead of directly including all the</span>
<span class="sd">        details in ``error_messsage`` is that converting large quantity arrays</span>
<span class="sd">        to strings can be rather costly and we don&#39;t want to do it if no error</span>
<span class="sd">        occured.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dim1, dim2 : `Dimension`, `Dimension`</span>
<span class="sd">        The physical dimensions of the two arguments (so that later code does</span>
<span class="sd">        not need to get the dimensions again).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    DimensionMismatchError</span>
<span class="sd">        If the dimensions of `obj1` and `obj2` do not match (or, if `obj2` is</span>
<span class="sd">        ``None``, in case `obj1` is not dimensionsless).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Implements special checking for ``0``, treating it as having &quot;any</span>
<span class="sd">    dimensions&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_checking</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">dim1</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="n">DIMENSIONLESS</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dim1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">dim2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dim1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dim2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Special treatment for &quot;0&quot;:</span>
        <span class="c1"># if it is not a Quantity, it has &quot;any dimension&quot;.</span>
        <span class="c1"># This allows expressions like 3*mV + 0 to pass (useful in cases where</span>
        <span class="c1"># zero is treated as the neutral element, e.g. in the Python sum</span>
        <span class="c1"># builtin) or comparisons like 3 * mV == 0 to return False instead of</span>
        <span class="c1"># failing # with a DimensionMismatchError. Note that 3*mV == 0*second</span>
        <span class="c1"># is not allowed, though.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dim1</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">obj1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">dim2</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">obj2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span>

        <span class="c1"># We do another check here, this should allow Brian1 units to pass as</span>
        <span class="c1"># having the same dimensions as a Brian2 unit</span>
        <span class="k">if</span> <span class="n">dim1</span> <span class="o">==</span> <span class="n">dim2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span>

        <span class="k">if</span> <span class="n">error_message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Dimension mismatch&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error_quantities</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="n">_short_str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">error_quantities</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="n">error_message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">error_quantities</span><span class="p">)</span>
        <span class="c1"># If we are comparing an object to a specific unit, we don&#39;t want to</span>
        <span class="c1"># restate this unit (it is probably mentioned in the text already)</span>
        <span class="k">if</span> <span class="n">obj2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="p">(</span><span class="n">Dimension</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">DimensionMismatchError</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">dim1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DimensionMismatchError</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span>


<span class="k">def</span> <span class="nf">wrap_function_dimensionless</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a new function that wraps the given function `func` so that it</span>
<span class="sd">    raises a DimensionMismatchError if the function is called on a quantity</span>
<span class="sd">    with dimensions (excluding dimensionless quantities). Quantities are</span>
<span class="sd">    transformed to unitless numpy arrays before calling `func`.</span>

<span class="sd">    These checks/transformations apply only to the very first argument, all</span>
<span class="sd">    other arguments are ignored/untouched.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">error_message</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> expects a dimensionless argument but got </span><span class="si">{value}</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">_arg_units</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">_return_unit</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">f</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">f</span>


<span class="k">def</span> <span class="nf">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a new function that wraps the given function `func` so that it</span>
<span class="sd">    keeps the dimensions of its input. Quantities are transformed to</span>
<span class="sd">    unitless numpy arrays before calling `func`, the output is a quantity</span>
<span class="sd">    with the original dimensions re-attached.</span>

<span class="sd">    These transformations apply only to the very first argument, all</span>
<span class="sd">    other arguments are ignored/untouched, allowing to work functions like</span>
<span class="sd">    ``sum`` to work as expected with additional ``axis`` etc. arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">_arg_units</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">_return_unit</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span>
    <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">f</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">f</span>


<span class="k">def</span> <span class="nf">wrap_function_change_dimensions</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">change_dim_func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a new function that wraps the given function `func` so that it</span>
<span class="sd">    changes the dimensions of its input. Quantities are transformed to</span>
<span class="sd">    unitless numpy arrays before calling `func`, the output is a quantity</span>
<span class="sd">    with the original dimensions passed through the function</span>
<span class="sd">    `change_dim_func`. A typical use would be a ``sqrt`` function that uses</span>
<span class="sd">    ``lambda d: d ** 0.5`` as ``change_dim_func``.</span>

<span class="sd">    These transformations apply only to the very first argument, all</span>
<span class="sd">    other arguments are ignored/untouched.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="n">change_dim_func</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>

    <span class="n">f</span><span class="o">.</span><span class="n">_arg_units</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">_return_unit</span> <span class="o">=</span> <span class="n">change_dim_func</span>
    <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">f</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">f</span>


<span class="k">def</span> <span class="nf">wrap_function_remove_dimensions</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a new function that wraps the given function `func` so that it</span>
<span class="sd">    removes any dimensions from its input. Useful for functions that are</span>
<span class="sd">    returning integers (indices) or booleans, irrespective of the datatype</span>
<span class="sd">    contained in the array.</span>

<span class="sd">    These transformations apply only to the very first argument, all</span>
<span class="sd">    other arguments are ignored/untouched.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">_arg_units</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">_return_unit</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">f</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">f</span>


<span class="c1"># SI dimensions (see table at the top of the file) and various descriptions,</span>
<span class="c1"># each description maps to an index i, and the power of each dimension</span>
<span class="c1"># is stored in the variable dims[i]</span>
<span class="n">_di</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Length&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;metre&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;metres&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;meter&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;meters&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;Mass&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;kilogram&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;kilograms&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;kg&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;second&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;seconds&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;Electric Current&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;electric current&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;Current&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;current&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;ampere&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;amperes&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;Temperature&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;kelvin&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;kelvins&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;Quantity of Substance&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;Quantity of substance&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;quantity of substance&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;Substance&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;substance&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;mole&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;moles&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;mol&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;Luminosity&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;luminosity&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;candle&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;candles&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;cd&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_ilabel</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;kg&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;mol&quot;</span><span class="p">,</span> <span class="s2">&quot;cd&quot;</span><span class="p">]</span>

<span class="c1"># The same labels with the names used for constructing them in Python code</span>
<span class="n">_iclass_label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span> <span class="s2">&quot;kilogram&quot;</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="s2">&quot;amp&quot;</span><span class="p">,</span> <span class="s2">&quot;kelvin&quot;</span><span class="p">,</span> <span class="s2">&quot;mole&quot;</span><span class="p">,</span> <span class="s2">&quot;candle&quot;</span><span class="p">]</span>

<span class="c1"># SI unit _prefixes as integer exponents of 10, see table at end of file.</span>
<span class="n">_siprefixes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">24</span><span class="p">,</span>
    <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">21</span><span class="p">,</span>
    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">18</span><span class="p">,</span>
    <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span>
    <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span>
    <span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;da&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
    <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
    <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">class</span> <span class="nc">Dimension</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores the indices of the 7 basic SI unit dimension (length, mass, etc.).</span>

<span class="sd">    Provides a subset of arithmetic operations appropriate to dimensions:</span>
<span class="sd">    multiplication, division and powers, and equality testing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dims : sequence of `float`</span>
<span class="sd">        The dimension indices of the 7 basic SI unit dimensions.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Users shouldn&#39;t use this class directly, it is used internally in Quantity</span>
<span class="sd">    and Unit. Even internally, never use ``Dimension(...)`` to create a new</span>
<span class="sd">    instance, use `get_or_create_dimension` instead. This function makes</span>
<span class="sd">    sure that only one Dimension instance exists for every combination of</span>
<span class="sd">    indices, allowing for a very fast dimensionality check with ``is``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_dims&quot;</span><span class="p">]</span>

    <span class="n">__array_priority__</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="c1">#### INITIALISATION ####</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span> <span class="o">=</span> <span class="n">dims</span>

    <span class="c1">#### METHODS ####</span>
    <span class="k">def</span> <span class="nf">get_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a specific dimension.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : `str`</span>
<span class="sd">            A string identifying the SI basic unit dimension. Can be either a</span>
<span class="sd">            description like &quot;length&quot; or a basic unit like &quot;m&quot; or &quot;metre&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dim : `float`</span>
<span class="sd">            The dimensionality of the dimension `d`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">[</span><span class="n">_di</span><span class="p">[</span><span class="n">d</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_dimensionless</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether this Dimension is dimensionless.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Normally, instead one should check dimension for being identical to</span>
<span class="sd">        `DIMENSIONLESS`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the `Dimension` object itself. This can be useful, because it</span>
<span class="sd">        allows to check for the dimension of an object by checking its ``dim``</span>
<span class="sd">        attribute -- this will return a `Dimension` object for `Quantity`,</span>
<span class="sd">        `Unit` and `Dimension`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1">#### REPRESENTATION ####</span>
    <span class="k">def</span> <span class="nf">_str_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_code</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation in basic SI units, or ``&quot;1&quot;`` for dimensionless.</span>
<span class="sd">        Use ``python_code=False`` for display purposes and ``True`` for valid</span>
<span class="sd">        Python code.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">python_code</span><span class="p">:</span>
            <span class="n">power_operator</span> <span class="o">=</span> <span class="s2">&quot; ** &quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">power_operator</span> <span class="o">=</span> <span class="s2">&quot;^&quot;</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">python_code</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">_iclass_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">_ilabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="n">power_operator</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">python_code</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot; * &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">()&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;1&quot;</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">_ilabel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;^{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;1&quot;</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_repr_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">$&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_representation</span><span class="p">(</span><span class="n">python_code</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_representation</span><span class="p">(</span><span class="n">python_code</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">#### ARITHMETIC ####</span>
    <span class="c1"># Note that none of the dimension arithmetic objects do sanity checking</span>
    <span class="c1"># on their inputs, although most will throw an exception if you pass the</span>
    <span class="c1"># wrong sort of input</span>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_or_create_dimension</span><span class="p">([</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">_dims</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_or_create_dimension</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">_dims</span><span class="p">)])</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Too many exponents&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">get_or_create_dimension</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Dimension object is immutable&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__idiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Dimension object is immutable&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Dimension object is immutable&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ipow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Dimension object is immutable&quot;</span><span class="p">)</span>

    <span class="c1">#### COMPARISON ####</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">_dims</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># Only compare equal to another Dimensions object</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">)</span>

    <span class="c1">#### MAKE DIMENSION PICKABLE ####</span>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span> <span class="o">=</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Make sure that unpickling Dimension objects does not bypass the singleton system</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">get_or_create_dimension</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">,))</span>

    <span class="c1">### Dimension objects are singletons and deepcopy is therefore not necessary</span>
    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memodict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="c1">#: The singleton object for dimensionless Dimensions.</span>
<span class="n">DIMENSIONLESS</span> <span class="o">=</span> <span class="n">Dimension</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">_dimensions</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">DIMENSIONLESS</span><span class="p">}</span>


<div class="viewcode-block" id="get_or_create_dimension">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.get_or_create_dimension">[docs]</a>
<span class="k">def</span> <span class="nf">get_or_create_dimension</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Dimension object or get a reference to an existing one.</span>
<span class="sd">    This function takes care of only creating new objects if they were not</span>
<span class="sd">    created before and otherwise returning a reference to an existing object.</span>
<span class="sd">    This allows to compare dimensions very efficiently using ``is``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args : sequence of `float`</span>
<span class="sd">        A sequence with the indices of the 7 elements of an SI dimension.</span>
<span class="sd">    kwds : keyword arguments</span>
<span class="sd">        a sequence of ``keyword=value`` pairs where the keywords are the names of</span>
<span class="sd">        the SI dimensions, or the standard unit.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The following are all definitions of the dimensions of force</span>

<span class="sd">    &gt;&gt;&gt; from brian2 import *</span>
<span class="sd">    &gt;&gt;&gt; get_or_create_dimension(length=1, mass=1, time=-2)</span>
<span class="sd">    metre * kilogram * second ** -2</span>
<span class="sd">    &gt;&gt;&gt; get_or_create_dimension(m=1, kg=1, s=-2)</span>
<span class="sd">    metre * kilogram * second ** -2</span>
<span class="sd">    &gt;&gt;&gt; get_or_create_dimension([1, 1, -2, 0, 0, 0, 0])</span>
<span class="sd">    metre * kilogram * second ** -2</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The 7 units are (in order):</span>

<span class="sd">    Length, Mass, Time, Electric Current, Temperature,</span>
<span class="sd">    Quantity of Substance, Luminosity</span>

<span class="sd">    and can be referred to either by these names or their SI unit names,</span>
<span class="sd">    e.g. length, metre, and m all refer to the same thing here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="c1"># initialisation by list</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Need a sequence of exactly 7 items&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># initialisation by keywords</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="c1"># _di stores the index of the dimension with name &#39;k&#39;</span>
            <span class="n">dims</span><span class="p">[</span><span class="n">_di</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="n">dims</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>

    <span class="c1"># check whether this Dimension object has already been created</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="ow">in</span> <span class="n">_dimensions</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_dimensions</span><span class="p">[</span><span class="n">dims</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_dim</span> <span class="o">=</span> <span class="n">Dimension</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
        <span class="n">_dimensions</span><span class="p">[</span><span class="n">dims</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_dim</span>
        <span class="k">return</span> <span class="n">new_dim</span></div>



<div class="viewcode-block" id="DimensionMismatchError">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.DimensionMismatchError">[docs]</a>
<span class="k">class</span> <span class="nc">DimensionMismatchError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception class for attempted operations with inconsistent dimensions.</span>

<span class="sd">    For example, ``3*mvolt + 2*amp`` raises this exception. The purpose of this</span>
<span class="sd">    class is to help catch errors based on incorrect units. The exception will</span>
<span class="sd">    print a representation of the dimensions of the two inconsistent objects</span>
<span class="sd">    that were operated on.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    description : ``str``</span>
<span class="sd">        A description of the type of operation being performed, e.g. Addition,</span>
<span class="sd">        Multiplication, etc.</span>
<span class="sd">    dims : `Dimension`</span>
<span class="sd">        The physical dimensions of the objects involved in the operation, any</span>
<span class="sd">        number of them is possible</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="o">*</span><span class="n">dims</span><span class="p">):</span>
        <span class="c1"># Call the base class constructor to make Exception pickable, see:</span>
        <span class="c1"># http://bugs.python.org/issue1692335</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="o">*</span><span class="n">dims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="n">dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">description</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dims_repr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">!r}</span><span class="s2">, </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dims_repr</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (unit is </span><span class="si">{</span><span class="n">get_unit_for_display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; (units are </span><span class="si">{</span><span class="n">get_unit_for_display</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">get_unit_for_display</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot; (units are&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">get_unit_for_display</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;).&quot;</span>
        <span class="k">return</span> <span class="n">s</span></div>



<div class="viewcode-block" id="is_scalar_type">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.is_scalar_type">[docs]</a>
<span class="k">def</span> <span class="nf">is_scalar_type</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tells you if the object is a 1d number type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : `object`</span>
<span class="sd">        The object to check.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scalar : `bool`</span>
<span class="sd">        ``True`` if `obj` is a scalar that can be interpreted as a</span>
<span class="sd">        dimensionless `Quantity`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">is_dimensionless</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_dimensions">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.get_dimensions">[docs]</a>
<span class="k">def</span> <span class="nf">get_dimensions</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the dimensions of any object that has them.</span>

<span class="sd">    Slightly more general than `Quantity.dimensions` because it will</span>
<span class="sd">    return `DIMENSIONLESS` if the object is of number type but not a `Quantity`</span>
<span class="sd">    (e.g. a `float` or `int`).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : `object`</span>
<span class="sd">        The object to check.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dim : `Dimension`</span>
<span class="sd">        The physical dimensions of the `obj`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">dim</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="c1"># The following is not very pretty, but it will avoid the costly</span>
        <span class="c1"># isinstance check for the common types</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="nb">bool</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">,</span>
            <span class="nb">float</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span>
        <span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">DIMENSIONLESS</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">dim</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not have dimensions&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="is_dimensionless">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.is_dimensionless">[docs]</a>
<span class="k">def</span> <span class="nf">is_dimensionless</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test if a value is dimensionless or not.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : `object`</span>
<span class="sd">        The object to check.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dimensionless : `bool`</span>
<span class="sd">        ``True`` if `obj` is dimensionless.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span></div>



<div class="viewcode-block" id="have_same_dimensions">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.have_same_dimensions">[docs]</a>
<span class="k">def</span> <span class="nf">have_same_dimensions</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test if two values have the same dimensions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj1, obj2 : {`Quantity`, array-like, number}</span>
<span class="sd">        The values of which to compare the dimensions.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    same : `bool`</span>
<span class="sd">        ``True`` if `obj1` and `obj2` have the same dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_checking</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># ignore units when unit checking is disabled</span>

    <span class="c1"># If dimensions are consistently created using get_or_create_dimensions,</span>
    <span class="c1"># the fast &quot;is&quot; comparison should always return the correct result.</span>
    <span class="c1"># To be safe, we also do an equals comparison in case it fails. This</span>
    <span class="c1"># should only add a small amount of unnecessary computation for cases in</span>
    <span class="c1"># which this function returns False which very likely leads to a</span>
    <span class="c1"># DimensionMismatchError anyway.</span>
    <span class="n">dim1</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span>
    <span class="n">dim2</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dim1</span> <span class="ow">is</span> <span class="n">dim2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dim1</span> <span class="o">==</span> <span class="n">dim2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dim1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dim2</span> <span class="ow">is</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="in_unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.in_unit">[docs]</a>
<span class="k">def</span> <span class="nf">in_unit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display a value in a certain unit with a given precision.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : {`Quantity`, array-like, number}</span>
<span class="sd">        The value to display</span>
<span class="sd">    u : {`Quantity`, `Unit`}</span>
<span class="sd">        The unit to display the value `x` in.</span>
<span class="sd">    precision : `int`, optional</span>
<span class="sd">        The number of digits of precision (in the given unit, see Examples).</span>
<span class="sd">        If no value is given, numpy&#39;s `get_printoptions` value is used.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    s : `str`</span>
<span class="sd">        A string representation of `x` in units of `u`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from brian2 import *</span>
<span class="sd">    &gt;&gt;&gt; in_unit(3 * volt, mvolt)</span>
<span class="sd">    &#39;3000. mV&#39;</span>
<span class="sd">    &gt;&gt;&gt; in_unit(123123 * msecond, second, 2)</span>
<span class="sd">    &#39;123.12 s&#39;</span>
<span class="sd">    &gt;&gt;&gt; in_unit(10 * uA/cm**2, nA/um**2)</span>
<span class="sd">    &#39;1.00000000e-04 nA/(um^2)&#39;</span>
<span class="sd">    &gt;&gt;&gt; in_unit(10 * mV, ohm * amp)</span>
<span class="sd">    &#39;0.01 ohm A&#39;</span>
<span class="sd">    &gt;&gt;&gt; in_unit(10 * nS, ohm) # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">    ...                       # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    DimensionMismatchError: Non-matching unit for method &quot;in_unit&quot;,</span>
<span class="sd">    dimensions were (m^-2 kg^-1 s^3 A^2) (m^2 kg s^-3 A^-2)</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    Quantity.in_unit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_dimensionless</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;Non-matching unit for function &quot;in_unit&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">u</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">in_unit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span></div>



<div class="viewcode-block" id="in_best_unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.in_best_unit">[docs]</a>
<span class="k">def</span> <span class="nf">in_best_unit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent the value in the &quot;best&quot; unit.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : {`Quantity`, array-like, number}</span>
<span class="sd">        The value to display</span>
<span class="sd">    precision : `int`, optional</span>
<span class="sd">        The number of digits of precision (in the best unit, see Examples).</span>
<span class="sd">        If no value is given, numpy&#39;s `get_printoptions` value is used.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    representation : `str`</span>
<span class="sd">        A string representation of this `Quantity`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from brian2.units import *</span>
<span class="sd">    &gt;&gt;&gt; in_best_unit(0.00123456 * volt)</span>
<span class="sd">    &#39;1.23456 mV&#39;</span>
<span class="sd">    &gt;&gt;&gt; in_best_unit(0.00123456 * volt, 2)</span>
<span class="sd">    &#39;1.23 mV&#39;</span>
<span class="sd">    &gt;&gt;&gt; in_best_unit(0.123456)</span>
<span class="sd">    &#39;0.123456&#39;</span>
<span class="sd">    &gt;&gt;&gt; in_best_unit(0.123456, 2)</span>
<span class="sd">    &#39;0.12&#39;</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    Quantity.in_best_unit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_dimensionless</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">get_printoptions</span><span class="p">()[</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">precision</span><span class="p">))</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">get_best_unit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">in_unit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">quantity_with_dimensions</span><span class="p">(</span><span class="n">floatval</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new `Quantity` with the given dimensions. Calls</span>
<span class="sd">    `get_or_create_dimensions` with the dimension tuple of the `dims`</span>
<span class="sd">    argument to make sure that unpickling (which calls this function) does not</span>
<span class="sd">    accidentally create new Dimension objects which should instead refer to</span>
<span class="sd">    existing ones.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    floatval : `float`</span>
<span class="sd">        The floating point value of the quantity.</span>
<span class="sd">    dims : `Dimension`</span>
<span class="sd">        The physical dimensions of the quantity.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : `Quantity`</span>
<span class="sd">        A quantity with the given dimensions.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from brian2 import *</span>
<span class="sd">    &gt;&gt;&gt; quantity_with_dimensions(0.001, volt.dim)</span>
<span class="sd">    1. * mvolt</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    get_or_create_dimensions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">floatval</span><span class="p">,</span> <span class="n">get_or_create_dimension</span><span class="p">(</span><span class="n">dims</span><span class="o">.</span><span class="n">_dims</span><span class="p">))</span>


<div class="viewcode-block" id="Quantity">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity">[docs]</a>
<span class="k">class</span> <span class="nc">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A number with an associated physical dimension. In most cases, it is not</span>
<span class="sd">    necessary to create a Quantity object by hand, instead use multiplication</span>
<span class="sd">    and division of numbers with the constant unit names ``second``,</span>
<span class="sd">    ``kilogram``, etc.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The `Quantity` class defines arithmetic operations which check for</span>
<span class="sd">    consistency of dimensions and raise the DimensionMismatchError exception</span>
<span class="sd">    if they are inconsistent. It also defines default and other representations</span>
<span class="sd">    for a number for printing purposes.</span>

<span class="sd">    See the documentation on the Unit class for more details</span>
<span class="sd">    about the available unit names like mvolt, etc.</span>

<span class="sd">    *Casting rules*</span>

<span class="sd">    The rules that define the casting operations for</span>
<span class="sd">    Quantity object are:</span>

<span class="sd">    1. Quantity op Quantity = Quantity</span>
<span class="sd">       Performs dimension checking if appropriate</span>
<span class="sd">    2. (Scalar or Array) op Quantity = Quantity</span>
<span class="sd">       Assumes that the scalar or array is dimensionless</span>

<span class="sd">    There is one exception to the above rule, the number ``0`` is interpreted</span>
<span class="sd">    as having &quot;any dimension&quot;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from brian2 import *</span>
<span class="sd">    &gt;&gt;&gt; I = 3 * amp # I is a Quantity object</span>
<span class="sd">    &gt;&gt;&gt; R = 2 * ohm # same for R</span>
<span class="sd">    &gt;&gt;&gt; I * R</span>
<span class="sd">    6. * volt</span>
<span class="sd">    &gt;&gt;&gt; (I * R).in_unit(mvolt)</span>
<span class="sd">    &#39;6000. mV&#39;</span>
<span class="sd">    &gt;&gt;&gt; (I * R) / mvolt</span>
<span class="sd">    6000.0</span>
<span class="sd">    &gt;&gt;&gt; X = I + R  # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    DimensionMismatchError: Addition, dimensions were (A) (m^2 kg s^-3 A^-2)</span>
<span class="sd">    &gt;&gt;&gt; Is = np.array([1, 2, 3]) * amp</span>
<span class="sd">    &gt;&gt;&gt; Is * R</span>
<span class="sd">    array([ 2.,  4.,  6.]) * volt</span>
<span class="sd">    &gt;&gt;&gt; np.asarray(Is * R) # gets rid of units</span>
<span class="sd">    array([ 2.,  4.,  6.])</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    Unit</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    dimensions</span>
<span class="sd">    is_dimensionless</span>
<span class="sd">    dim : Dimensions</span>
<span class="sd">        The physical dimensions of this quantity.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    with_dimensions</span>
<span class="sd">    has_same_dimensions</span>
<span class="sd">    in_unit</span>
<span class="sd">    in_best_unit</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dim&quot;</span><span class="p">]</span>

    <span class="n">__array_priority__</span> <span class="o">=</span> <span class="mi">1000</span>

    <span class="c1"># ==========================================================================</span>
    <span class="c1"># Construction and handling of numpy ufuncs</span>
    <span class="c1"># ==========================================================================</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_quantity</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Do not create dimensionless quantities, use pure numpy arrays instead</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_quantity</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="c1"># For scalar values, return a simple Python object instead of</span>
                <span class="c1"># a numpy scalar</span>
                <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">arr</span>

        <span class="c1"># All np.ndarray subclasses need something like this, see</span>
        <span class="c1"># http://www.scipy.org/Subclasses</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">subarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="c1"># We only want numerical datatypes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">subarr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Quantities can only be created from numerical data.&quot;</span><span class="p">)</span>

        <span class="c1"># If a dimension is given, force this dimension</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subarr</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
            <span class="k">return</span> <span class="n">subarr</span>

        <span class="c1"># Use the given dimension or the dimension of the given array (if any)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subarr</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">dim</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)):</span>
                <span class="c1"># check whether it is an iterable containing Quantity objects</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">is_quantity</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">arr</span><span class="p">)]</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="c1"># Not iterable</span>
                    <span class="n">is_quantity</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">is_quantity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Empty list</span>
                    <span class="n">subarr</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">DIMENSIONLESS</span>
                <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">is_quantity</span><span class="p">):</span>
                    <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">arr</span><span class="p">)]</span>
                    <span class="n">one_dim</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="n">one_dim</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">DimensionMismatchError</span><span class="p">(</span>
                                <span class="s2">&quot;Mixing quantities &quot;</span>
                                <span class="s2">&quot;with different &quot;</span>
                                <span class="s2">&quot;dimensions is not &quot;</span>
                                <span class="s2">&quot;allowed&quot;</span><span class="p">,</span>
                                <span class="n">d</span><span class="p">,</span>
                                <span class="n">one_dim</span><span class="p">,</span>
                            <span class="p">)</span>
                    <span class="n">subarr</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">is_quantity</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;Mixing quantities and non-quantities is not allowed.&quot;</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">subarr</span>

    <span class="k">def</span> <span class="nf">__array_finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="n">DIMENSIONLESS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__array_ufunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uf</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__call__&quot;</span><span class="p">,</span> <span class="s2">&quot;reduce&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="n">uf_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">uf</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># In contrast to numpy, we will not change a scalar value in-place,</span>
            <span class="c1"># i.e. a scalar Quantity will act like a Python float and not like</span>
            <span class="c1"># a numpy scalar in that regard.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The output needs to be an array to avoid infinite recursion</span>
                <span class="c1"># Note that it is also part of the input arguments, so we don&#39;t</span>
                <span class="c1"># need to check its dimensions</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),)</span>
        <span class="k">if</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">(</span><span class="n">UFUNCS_LOGICAL</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">,</span> <span class="s2">&quot;ones_like&quot;</span><span class="p">]):</span>
            <span class="c1"># do not touch return value</span>
            <span class="k">return</span> <span class="n">uf_method</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">UFUNCS_PRESERVE_DIMENSIONS</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span>
                <span class="n">uf_method</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">UFUNCS_CHANGE_DIMENSIONS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;power&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;power&quot;</span><span class="p">:</span>
                <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span>
                    <span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">error_message</span><span class="o">=</span><span class="p">(</span>
                        <span class="s2">&quot;The exponent for a &quot;</span>
                        <span class="s2">&quot;power operation has to &quot;</span>
                        <span class="s2">&quot;be dimensionless but &quot;</span>
                        <span class="s2">&quot;was </span><span class="si">{value}</span><span class="s2">&quot;</span>
                    <span class="p">),</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;Only length-1 arrays can be used as an exponent for&quot;</span>
                        <span class="s2">&quot; quantities.&quot;</span>
                    <span class="p">)</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;square&quot;</span><span class="p">:</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;divide&quot;</span><span class="p">,</span> <span class="s2">&quot;true_divide&quot;</span><span class="p">,</span> <span class="s2">&quot;floor_divide&quot;</span><span class="p">):</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;multiply&quot;</span><span class="p">,</span> <span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="s2">&quot;matmul&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;__call__&quot;</span><span class="p">:</span>
                    <span class="n">dim</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dim</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">NotImplemented</span>
            <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span>
                <span class="n">uf_method</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">UFUNCS_INTEGERS</span><span class="p">:</span>
            <span class="c1"># Numpy should already raise a TypeError by itself</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> cannot be used on quantities.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">UFUNCS_MATCHING_DIMENSIONS</span> <span class="o">+</span> <span class="n">UFUNCS_COMPARISONS</span><span class="p">:</span>
            <span class="c1"># Ok if dimension of arguments match (for reductions, they always do)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;__call__&quot;</span><span class="p">:</span>
                <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span>
                    <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">error_message</span><span class="o">=</span><span class="p">(</span>
                        <span class="s2">&quot;Cannot calculate </span><span class="si">{val1}</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">{val2}</span><span class="s2">, the units do not match&quot;</span>
                    <span class="p">)</span>
                    <span class="o">%</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">val1</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">val2</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">UFUNCS_COMPARISONS</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">uf_method</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span>
                    <span class="n">uf_method</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                    <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">UFUNCS_DIMENSIONLESS</span><span class="p">:</span>
            <span class="c1"># Ok if argument is dimensionless</span>
            <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span>
                <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> expects a dimensionless argument but got </span><span class="si">{value}</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">uf_method</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="o">*</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">UFUNCS_DIMENSIONLESS_TWOARGS</span><span class="p">:</span>
            <span class="c1"># Ok if both arguments are dimensionless</span>
            <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span>
                <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">error_message</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;Both arguments for &quot;</span>
                    <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; should be &#39;</span>
                    <span class="s2">&quot;dimensionless but &quot;</span>
                    <span class="s2">&quot;first argument was &quot;</span>
                    <span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="o">%</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span>
                <span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">error_message</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;Both arguments for &quot;</span>
                    <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; should be &#39;</span>
                    <span class="s2">&quot;dimensionless but &quot;</span>
                    <span class="s2">&quot;second argument was &quot;</span>
                    <span class="s2">&quot;</span><span class="si">{value}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="o">%</span> <span class="n">uf</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">uf_method</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="o">*</span><span class="n">inputs</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ==============================================================================</span>
    <span class="c1"># Quantity-specific functions (not existing in ndarray)</span>
    <span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Quantity.with_dimensions">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.with_dimensions">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">with_dimensions</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a `Quantity` object with dim.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : {array_like, number}</span>
<span class="sd">            The value of the dimension</span>
<span class="sd">        args : {`Dimension`, sequence of float}</span>
<span class="sd">            Either a single argument (a `Dimension`) or a sequence of 7 values.</span>
<span class="sd">        kwds</span>
<span class="sd">            Keywords defining the dim, see `Dimension` for details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : `Quantity`</span>
<span class="sd">            A `Quantity` object with the given dim</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        All of these define an equivalent `Quantity` object:</span>

<span class="sd">        &gt;&gt;&gt; from brian2 import *</span>
<span class="sd">        &gt;&gt;&gt; Quantity.with_dimensions(2, get_or_create_dimension(length=1))</span>
<span class="sd">        2. * metre</span>
<span class="sd">        &gt;&gt;&gt; Quantity.with_dimensions(2, length=1)</span>
<span class="sd">        2. * metre</span>
<span class="sd">        &gt;&gt;&gt; 2 * metre</span>
<span class="sd">        2. * metre</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Dimension</span><span class="p">):</span>
            <span class="n">dimensions</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dimensions</span> <span class="o">=</span> <span class="n">get_or_create_dimension</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dimensions</span><span class="p">)</span></div>


    <span class="c1">### ATTRIBUTES ###</span>
    <span class="n">is_dimensionless</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">.</span><span class="n">is_dimensionless</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Whether this is a dimensionless quantity.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The physical dimensions of this quantity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>

    <span class="nd">@dimensions</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>

    <span class="c1">#### METHODS ####</span>

<div class="viewcode-block" id="Quantity.has_same_dimensions">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.has_same_dimensions">[docs]</a>
    <span class="k">def</span> <span class="nf">has_same_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether this object has the same dimensions as another.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : {`Quantity`, array-like, number}</span>
<span class="sd">            The object to compare the dimensions against.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        same : `bool`</span>
<span class="sd">            ``True`` if `other` has the same dimensions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_checking</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># ignore units if unit checking is disabled</span>

        <span class="n">other_dim</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="ow">is</span> <span class="n">other_dim</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="n">other_dim</span><span class="p">)</span></div>


<div class="viewcode-block" id="Quantity.in_unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.in_unit">[docs]</a>
    <span class="k">def</span> <span class="nf">in_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">python_code</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Represent the quantity in a given unit. If `python_code` is ``True``,</span>
<span class="sd">        this will return valid python code, i.e. a string like ``5.0 * um ** 2``</span>
<span class="sd">        instead of ``5.0 um^2``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        u : {`Quantity`, `Unit`}</span>
<span class="sd">            The unit in which to show the quantity.</span>
<span class="sd">        precision : `int`, optional</span>
<span class="sd">            The number of digits of precision (in the given unit, see Examples).</span>
<span class="sd">            If no value is given, numpy&#39;s `get_printoptions` value is used.</span>
<span class="sd">        python_code : `bool`, optional</span>
<span class="sd">            Whether to return valid python code (``True``) or a human readable</span>
<span class="sd">            string (``False``, the default).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        s : `str`</span>
<span class="sd">            String representation of the object in unit `u`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from brian2.units import *</span>
<span class="sd">        &gt;&gt;&gt; from brian2.units.stdunits import *</span>
<span class="sd">        &gt;&gt;&gt; x = 25.123456 * mV</span>
<span class="sd">        &gt;&gt;&gt; x.in_unit(volt)</span>
<span class="sd">        &#39;0.02512346 V&#39;</span>
<span class="sd">        &gt;&gt;&gt; x.in_unit(volt, 3)</span>
<span class="sd">        &#39;0.025 V&#39;</span>
<span class="sd">        &gt;&gt;&gt; x.in_unit(mV, 3)</span>
<span class="sd">        &#39;25.123 mV&#39;</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        in_unit</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;Non-matching unit for method &quot;in_unit&quot;&#39;</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span> <span class="o">/</span> <span class="n">u</span><span class="p">)</span>
        <span class="c1"># numpy uses the printoptions setting only in arrays, not in array</span>
        <span class="c1"># scalars, so we use this hackish way of turning the scalar first into</span>
        <span class="c1"># an array, then removing the square brackets from the output</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">value</span><span class="p">]),</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">python_code</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_repr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">u</span><span class="o">.</span><span class="n">is_dimensionless</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">python_code</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; * </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">python_code</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; * </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">python_code</span><span class="p">:</span>  <span class="c1"># Make a quantity without unit recognisable</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>


<div class="viewcode-block" id="Quantity.get_best_unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.get_best_unit">[docs]</a>
    <span class="k">def</span> <span class="nf">get_best_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">regs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the best unit for this `Quantity`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        regs : any number of `UnitRegistry` objects</span>
<span class="sd">            The registries that are searched for units. If none are provided, it</span>
<span class="sd">            will check the standard, user and additional unit registers in turn.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            u : `Quantity` or `Unit`</span>
<span class="sd">                The best-fitting unit for the quantity `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dimensionless</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Unit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">regs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regs</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_unit</span><span class="p">(</span>
                <span class="n">standard_unit_register</span><span class="p">,</span> <span class="n">user_unit_register</span><span class="p">,</span> <span class="n">additional_unit_register</span>
            <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_best_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">regs</span><span class="p">):</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Quantity._get_best_unit has been renamed to Quantity.get_best_unit.&quot;</span><span class="p">,</span>
            <span class="n">VisibleDeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_unit</span><span class="p">(</span><span class="o">*</span><span class="n">regs</span><span class="p">)</span>

<div class="viewcode-block" id="Quantity.in_best_unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.in_best_unit">[docs]</a>
    <span class="k">def</span> <span class="nf">in_best_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">python_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">regs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Represent the quantity in the &quot;best&quot; unit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        python_code : `bool`, optional</span>
<span class="sd">            If set to ``False`` (the default), will return a string like</span>
<span class="sd">            ``5.0 um^2`` which is not a valid Python expression. If set to</span>
<span class="sd">            ``True``, it will return ``5.0 * um ** 2`` instead.</span>
<span class="sd">        precision : `int`, optional</span>
<span class="sd">            The number of digits of precision (in the best unit, see</span>
<span class="sd">            Examples). If no value is given, numpy&#39;s</span>
<span class="sd">            `get_printoptions` value is used.</span>
<span class="sd">        regs : `UnitRegistry` objects</span>
<span class="sd">            The registries where to search for units. If none are given, the</span>
<span class="sd">            standard, user-defined and additional registries are searched in</span>
<span class="sd">            that order.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        representation : `str`</span>
<span class="sd">            A string representation of this `Quantity`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from brian2.units import *</span>

<span class="sd">        &gt;&gt;&gt; x = 0.00123456 * volt</span>

<span class="sd">        &gt;&gt;&gt; x.in_best_unit()</span>
<span class="sd">        &#39;1.23456 mV&#39;</span>

<span class="sd">        &gt;&gt;&gt; x.in_best_unit(3)</span>
<span class="sd">        &#39;1.235 mV&#39;</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        in_best_unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_unit</span><span class="p">(</span><span class="o">*</span><span class="n">regs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_unit</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">python_code</span><span class="o">=</span><span class="n">python_code</span><span class="p">)</span></div>


    <span class="c1"># ==============================================================================</span>
    <span class="c1"># Overwritten ndarray methods</span>
    <span class="c1"># ==============================================================================</span>

    <span class="c1">#### Setting/getting items ####</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overwritten to assure that single elements (i.e., indexed with a</span>
<span class="sd">        single integer or a tuple of integers) retain their unit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>

<div class="viewcode-block" id="Quantity.item">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.item">[docs]</a>
    <span class="k">def</span> <span class="nf">item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overwritten to assure that the returned element retains its unit.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Inconsistent units in assignment&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="Quantity.tolist">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.tolist">[docs]</a>
    <span class="k">def</span> <span class="nf">tolist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the array into a list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        l : list of `Quantity`</span>
<span class="sd">            A (possibly nested) list equivalent to the original array.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">replace_with_quantity</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Replace all the elements in the list with an equivalent `Quantity`</span>
<span class="sd">            with the given `dim`.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># No recursion needed for single values</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">top_replace</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Recursivley descend into the list.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="n">top_replace</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">seq</span><span class="p">)(</span><span class="n">top_replace</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">replace_with_quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span></div>


    <span class="c1">#### COMPARISONS ####</span>
    <span class="k">def</span> <span class="nf">_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">operator_str</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
        <span class="n">is_scalar</span> <span class="o">=</span> <span class="n">is_scalar_type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_scalar</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_scalar</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Cannot perform comparison </span><span class="si">{value1}</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">{value2}</span><span class="s2">, units do not match&quot;</span>
                <span class="o">%</span> <span class="n">operator_str</span>
            <span class="p">)</span>
            <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">value1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">value2</span><span class="o">=</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">operation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;==&quot;</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;!=&quot;</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span><span class="p">)</span>

    <span class="c1">#### MAKE QUANTITY PICKABLE ####</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">quantity_with_dimensions</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>

    <span class="c1">#### REPRESENTATION ####</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_best_unit</span><span class="p">(</span><span class="n">python_code</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translates a scalar, 1-d or 2-d array into a LaTeX representation. Will be called</span>
<span class="sd">        by ``sympy``&#39;s `~sympy.latex` function and used as a &quot;rich representation&quot; in e.g.</span>
<span class="sd">        jupyter notebooks.</span>
<span class="sd">        The values in the array will be formatted with `numpy.array2string` and will</span>
<span class="sd">        therefore observe ``numpy``&#39;s &quot;print options&quot; such as ``precision``. Including</span>
<span class="sd">        all numbers in the LaTeX output will rarely be useful for large arrays; this</span>
<span class="sd">        function will therefore apply a ``threshold`` value divided by 100 (the default</span>
<span class="sd">        ``threshold`` value is 1000, this function hence applies 10). Note that the</span>
<span class="sd">        ``max_line_width`` print option is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">best_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_unit</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">best_unit</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
            <span class="n">best_unit_latex</span> <span class="o">=</span> <span class="n">latex</span><span class="p">(</span><span class="n">best_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># A quantity</span>
            <span class="n">best_unit_latex</span> <span class="o">=</span> <span class="n">latex</span><span class="p">(</span><span class="n">best_unit</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
        <span class="n">unitless</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span> <span class="o">/</span> <span class="n">best_unit</span><span class="p">)</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">get_printoptions</span><span class="p">()[</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span> <span class="o">//</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">unitless</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sympy_quantity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">unitless</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unitless</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">array_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span>
                <span class="n">unitless</span><span class="p">,</span>
                <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; &amp; &quot;</span><span class="p">,</span>
                <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                <span class="n">max_line_width</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Replace [ and ]</span>
            <span class="n">sympy_quantity</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;\left[\begin</span><span class="si">{matrix}</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">array_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\dots&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{matrix}</span><span class="s2">\right]&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">unitless</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">array_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span>
                <span class="n">unitless</span><span class="p">,</span>
                <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; &amp; &quot;</span><span class="p">,</span>
                <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                <span class="n">max_line_width</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">array_str</span> <span class="o">=</span> <span class="n">array_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\dots&quot;</span><span class="p">)</span>
            <span class="n">array_str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">array_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;] &amp;&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">array_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">n_cols</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="sa">r</span><span class="s2">&quot;\dots &amp;&quot;</span><span class="p">:</span>
                    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">r</span><span class="s2">&quot;\vdots&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">sympy_quantity</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;\left[\begin</span><span class="si">{matrix}</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>
                <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{matrix}</span><span class="s2">\right]&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot create a LaTeX representation for a </span><span class="si">{</span><span class="n">unitless</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">-d matrix.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sympy_quantity</span><span class="si">}</span><span class="se">\\</span><span class="s2">,</span><span class="si">{</span><span class="n">best_unit_latex</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_repr_latex_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">$&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_best_unit</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">):</span>
        <span class="c1"># Avoid that formatted strings like f&quot;{q}&quot; use floating point formatting for the</span>
        <span class="c1"># quantity, i.e. discard the unit</span>
        <span class="k">if</span> <span class="n">format_spec</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__format__</span><span class="p">(</span><span class="n">format_spec</span><span class="p">)</span>

    <span class="c1">#### Mathematic methods ####</span>

    <span class="n">cumsum</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">cumsum</span><span class="p">)</span>
    <span class="n">diagonal</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">diagonal</span><span class="p">)</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
    <span class="n">ptp</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">ptp</span><span class="p">)</span>

    <span class="c1"># To work around an issue in matplotlib 1.3.1 (see</span>
    <span class="c1"># https://github.com/matplotlib/matplotlib/pull/2591), we make `ravel`</span>
    <span class="c1"># return a unitless array and emit a warning explaining the issue.</span>
    <span class="n">use_matplotlib_units_fix</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib</span>

        <span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">__version__</span> <span class="o">==</span> <span class="s2">&quot;1.3.1&quot;</span><span class="p">:</span>
            <span class="n">use_matplotlib_units_fix</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">use_matplotlib_units_fix</span><span class="p">:</span>

<div class="viewcode-block" id="Quantity.ravel">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.ravel">[docs]</a>
        <span class="k">def</span> <span class="nf">ravel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="c1"># Note that we don&#39;t use Brian&#39;s logging system here as we don&#39;t want</span>
            <span class="c1"># the unit system to depend on other parts of Brian</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;As a workaround for a bug in matplotlib 1.3.1, calling &quot;</span>
                <span class="s1">&#39;&quot;ravel()&quot; on a quantity will return unit-less values. If you &#39;</span>
                <span class="s2">&quot;get this warning during plotting, consider removing the units &quot;</span>
                <span class="s2">&quot;before plotting, e.g. by dividing by the unit. If you are &quot;</span>
                <span class="s1">&#39;explicitly calling &quot;ravel()&quot;, consider using &quot;flatten()&quot; &#39;</span>
                <span class="s2">&quot;instead.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>


        <span class="n">ravel</span><span class="o">.</span><span class="n">_arg_units</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">ravel</span><span class="o">.</span><span class="n">_return_unit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ravel</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">ravel</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">ravel</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">ravel</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ravel</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">ravel</span><span class="p">)</span>

    <span class="nb">round</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">round</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">std</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">wrap_function_keep_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">trace</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">wrap_function_change_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">ar</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="n">wrap_function_remove_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
    <span class="nb">any</span> <span class="o">=</span> <span class="n">wrap_function_remove_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">any</span><span class="p">)</span>
    <span class="n">nonzero</span> <span class="o">=</span> <span class="n">wrap_function_remove_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">nonzero</span><span class="p">)</span>
    <span class="n">argmax</span> <span class="o">=</span> <span class="n">wrap_function_remove_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">argmax</span><span class="p">)</span>
    <span class="n">argmin</span> <span class="o">=</span> <span class="n">wrap_function_remove_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">argmin</span><span class="p">)</span>
    <span class="n">argsort</span> <span class="o">=</span> <span class="n">wrap_function_remove_dimensions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">argsort</span><span class="p">)</span>

<div class="viewcode-block" id="Quantity.fill">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.fill">[docs]</a>
    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="s2">&quot;fill&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>


    <span class="n">fill</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">fill</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">fill</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Quantity.put">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.put">[docs]</a>
    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="s2">&quot;fill&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>


    <span class="n">put</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">put</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">put</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Quantity.clip">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.clip">[docs]</a>
    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_min</span><span class="p">,</span> <span class="n">a_max</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_min</span><span class="p">,</span> <span class="s2">&quot;clip&quot;</span><span class="p">)</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_max</span><span class="p">,</span> <span class="s2">&quot;clip&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_min</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_max</span><span class="p">),</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="n">clip</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">clip</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">clip</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Quantity.dot">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.dot">[docs]</a>
    <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="o">**</span><span class="n">kwds</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">*</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">other</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="n">dot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">dot</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">dot</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Quantity.searchsorted">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.searchsorted">[docs]</a>
    <span class="k">def</span> <span class="nf">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="n">fail_for_dimension_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="s2">&quot;searchsorted&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>


    <span class="n">searchsorted</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">searchsorted</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">searchsorted</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Quantity.prod">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.prod">[docs]</a>
    <span class="k">def</span> <span class="nf">prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="n">prod_result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="c1"># Calculating the correct dimensions is not completly trivial (e.g.</span>
        <span class="c1"># like doing self.dim**self.size) because prod can be called on</span>
        <span class="c1"># multidimensional arrays along a certain axis.</span>
        <span class="c1"># Our solution: Use a &quot;dummy matrix&quot; containing a 1 (without units) at</span>
        <span class="c1"># each entry and sum it, using the same keyword arguments as provided.</span>
        <span class="c1"># The result gives the exponent for the dimensions.</span>
        <span class="c1"># This relies on sum and prod having the same arguments, which is true</span>
        <span class="c1"># now and probably remains like this in the future</span>
        <span class="n">dim_exponent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="c1"># The result is possibly multidimensional but all entries should be</span>
        <span class="c1"># identical</span>
        <span class="k">if</span> <span class="n">dim_exponent</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dim_exponent</span> <span class="o">=</span> <span class="n">dim_exponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">prod_result</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">**</span><span class="n">dim_exponent</span><span class="p">)</span></div>


    <span class="n">prod</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">prod</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Quantity.cumprod">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Quantity.cumprod">[docs]</a>
    <span class="k">def</span> <span class="nf">cumprod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>  <span class="c1"># pylint: disable=C0111</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dimensionless</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;cumprod over array elements on quantities &quot;</span>
                <span class="s2">&quot;with dimensions is not possible.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">))</span></div>


    <span class="n">cumprod</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">cumprod</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">cumprod</span><span class="o">.</span><span class="n">_do_not_run_doctests</span> <span class="o">=</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="Unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Unit">[docs]</a>
<span class="k">class</span> <span class="nc">Unit</span><span class="p">(</span><span class="n">Quantity</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     A physical unit.</span>

<span class="sd">     Normally, you do not need to worry about the implementation of</span>
<span class="sd">     units. They are derived from the `Quantity` object with</span>
<span class="sd">     some additional information (name and string representation).</span>

<span class="sd">     Basically, a unit is just a number with given dimensions, e.g.</span>
<span class="sd">     mvolt = 0.001 with the dimensions of voltage. The units module</span>
<span class="sd">     defines a large number of standard units, and you can also define</span>
<span class="sd">     your own (see below).</span>

<span class="sd">     The unit class also keeps track of various things that were used</span>
<span class="sd">     to define it so as to generate a nice string representation of it.</span>
<span class="sd">     See below.</span>

<span class="sd">     When creating scaled units, you can use the following prefixes:</span>

<span class="sd">      ======     ======  ==============</span>
<span class="sd">      Factor     Name    Prefix</span>
<span class="sd">      ======     ======  ==============</span>
<span class="sd">      10^24      yotta   Y</span>
<span class="sd">      10^21      zetta   Z</span>
<span class="sd">      10^18      exa     E</span>
<span class="sd">      10^15      peta    P</span>
<span class="sd">      10^12      tera    T</span>
<span class="sd">      10^9       giga    G</span>
<span class="sd">      10^6       mega    M</span>
<span class="sd">      10^3       kilo    k</span>
<span class="sd">      10^2       hecto   h</span>
<span class="sd">      10^1       deka    da</span>
<span class="sd">      1</span>
<span class="sd">      10^-1      deci    d</span>
<span class="sd">      10^-2      centi   c</span>
<span class="sd">      10^-3      milli   m</span>
<span class="sd">      10^-6      micro   u (\mu in SI)</span>
<span class="sd">      10^-9      nano    n</span>
<span class="sd">      10^-12     pico    p</span>
<span class="sd">      10^-15     femto   f</span>
<span class="sd">      10^-18     atto    a</span>
<span class="sd">      10^-21     zepto   z</span>
<span class="sd">      10^-24     yocto   y</span>
<span class="sd">      ======     ======  ==============</span>

<span class="sd">    **Defining your own**</span>

<span class="sd">     It can be useful to define your own units for printing</span>
<span class="sd">     purposes. So for example, to define the newton metre, you</span>
<span class="sd">     write</span>

<span class="sd">     &gt;&gt;&gt; from brian2 import *</span>
<span class="sd">     &gt;&gt;&gt; from brian2.units.allunits import newton</span>
<span class="sd">     &gt;&gt;&gt; Nm = newton * metre</span>

<span class="sd">     You can then do</span>

<span class="sd">     &gt;&gt;&gt; (1*Nm).in_unit(Nm)</span>
<span class="sd">     &#39;1. N m&#39;</span>

<span class="sd">     New &quot;compound units&quot;, i.e. units that are composed of other units will be</span>
<span class="sd">     automatically registered and from then on used for display. For example,</span>
<span class="sd">     imagine you define total conductance for a membrane, and the total area of</span>
<span class="sd">     that membrane:</span>

<span class="sd">     &gt;&gt;&gt; conductance = 10.*nS</span>
<span class="sd">     &gt;&gt;&gt; area = 20000*um**2</span>

<span class="sd">     If you now ask for the conductance density, you will get an &quot;ugly&quot; display</span>
<span class="sd">     in basic SI dimensions, as Brian does not know of a corresponding unit:</span>

<span class="sd">     &gt;&gt;&gt; conductance/area</span>
<span class="sd">     0.5 * metre ** -4 * kilogram ** -1 * second ** 3 * amp ** 2</span>

<span class="sd">     By using an appropriate unit once, it will be registered and from then on</span>
<span class="sd">     used for display when appropriate:</span>

<span class="sd">     &gt;&gt;&gt; usiemens/cm**2</span>
<span class="sd">     usiemens / (cmetre ** 2)</span>
<span class="sd">     &gt;&gt;&gt; conductance/area  # same as before, but now Brian knows about uS/cm^2</span>
<span class="sd">     50. * usiemens / (cmetre ** 2)</span>

<span class="sd">     Note that user-defined units cannot override the standard units (`volt`,</span>
<span class="sd">     `second`, etc.) that are predefined by Brian. For example, the unit</span>
<span class="sd">     ``Nm`` has the dimensions &quot;length²·mass/time²&quot;, and therefore the same</span>
<span class="sd">     dimensions as the standard unit `joule`. The latter will be used for display</span>
<span class="sd">     purposes:</span>

<span class="sd">     &gt;&gt;&gt; 3*joule</span>
<span class="sd">     3. * joule</span>
<span class="sd">     &gt;&gt;&gt; 3*Nm</span>
<span class="sd">     3. * joule</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;_dispname&quot;</span><span class="p">,</span> <span class="s2">&quot;_name&quot;</span><span class="p">,</span> <span class="s2">&quot;_latexname&quot;</span><span class="p">,</span> <span class="s2">&quot;iscompound&quot;</span><span class="p">]</span>

    <span class="n">__array_priority__</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">automatically_register_units</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1">#### CONSTRUCTION ####</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">arr</span><span class="p">,</span>
        <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dispname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">latexname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">iscompound</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">DIMENSIONLESS</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">,</span> <span class="n">force_quantity</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">__array_finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="n">DIMENSIONLESS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="s2">&quot;_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dispname</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="s2">&quot;_dispname&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latexname</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="s2">&quot;_latexname&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iscompound</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="s2">&quot;_iscompound&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">,</span>
        <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dispname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">latexname</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">iscompound</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unit value has to be 10**scale (scale=</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">, value=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">DIMENSIONLESS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>  <span class="c1">#: The Dimensions of this unit</span>

        <span class="c1">#: The scale for this unit (as the integer exponent of 10), i.e.</span>
        <span class="c1">#: a scale of 3 means 10^3, e.g. for a &quot;k&quot; prefix.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Unit(1)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dispname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span><span class="p">:</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="c1">#: The full name of this unit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1">#: The display name of this unit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dispname</span> <span class="o">=</span> <span class="n">dispname</span>
        <span class="c1">#: A LaTeX expression for the name of this unit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latexname</span> <span class="o">=</span> <span class="n">latexname</span>
        <span class="c1">#: Whether this unit is a combination of other units.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iscompound</span> <span class="o">=</span> <span class="n">iscompound</span>

        <span class="k">if</span> <span class="n">Unit</span><span class="o">.</span><span class="n">automatically_register_units</span><span class="p">:</span>
            <span class="n">register_new_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Unit.create">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Unit.create">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dispname</span><span class="p">,</span> <span class="n">latexname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new named unit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dim : `Dimension`</span>
<span class="sd">            The dimensions of the unit.</span>
<span class="sd">        name : `str`</span>
<span class="sd">            The full name of the unit, e.g. ``&#39;volt&#39;``</span>
<span class="sd">        dispname : `str`</span>
<span class="sd">            The display name, e.g. ``&#39;V&#39;``</span>
<span class="sd">        latexname : str, optional</span>
<span class="sd">            The name as a LaTeX expression (math mode is assumed, do not add</span>
<span class="sd">            $ signs or similar), e.g. ``&#39;\\omega&#39;``. If no `latexname` is</span>
<span class="sd">            specified, `dispname` will be used.</span>
<span class="sd">        scale : int, optional</span>
<span class="sd">            The scale of this unit as an exponent of 10, e.g. -3 for a unit that</span>
<span class="sd">            is 1/1000 of the base scale. Defaults to 0 (i.e. a base unit).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        u : `Unit`</span>
<span class="sd">            The new unit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">dispname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dispname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">latexname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">latexname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">mathrm</span><span class="se">{{</span><span class="si">{</span><span class="n">dispname</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
            <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">dispname</span><span class="o">=</span><span class="n">dispname</span><span class="p">,</span>
            <span class="n">latexname</span><span class="o">=</span><span class="n">latexname</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span></div>


<div class="viewcode-block" id="Unit.create_scaled_unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Unit.create_scaled_unit">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_scaled_unit</span><span class="p">(</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">scalefactor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a scaled unit from a base unit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        baseunit : `Unit`</span>
<span class="sd">            The unit of which to create a scaled version, e.g. ``volt``,</span>
<span class="sd">            ``amp``.</span>
<span class="sd">        scalefactor : `str`</span>
<span class="sd">            The scaling factor, e.g. ``&quot;m&quot;`` for mvolt, mamp</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        u : `Unit`</span>
<span class="sd">            The new unit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">scalefactor</span> <span class="o">+</span> <span class="n">baseunit</span><span class="o">.</span><span class="n">name</span>
        <span class="n">dispname</span> <span class="o">=</span> <span class="n">scalefactor</span> <span class="o">+</span> <span class="n">baseunit</span><span class="o">.</span><span class="n">dispname</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">_siprefixes</span><span class="p">[</span><span class="n">scalefactor</span><span class="p">]</span> <span class="o">+</span> <span class="n">baseunit</span><span class="o">.</span><span class="n">scale</span>
        <span class="k">if</span> <span class="n">scalefactor</span> <span class="o">==</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span>
            <span class="n">scalefactor</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\mu&quot;</span>
        <span class="n">latexname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">mathrm</span><span class="se">{{</span><span class="si">{</span><span class="n">scalefactor</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">baseunit</span><span class="o">.</span><span class="n">latexname</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
            <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">dim</span><span class="o">=</span><span class="n">baseunit</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">dispname</span><span class="o">=</span><span class="n">dispname</span><span class="p">,</span>
            <span class="n">latexname</span><span class="o">=</span><span class="n">latexname</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span></div>


    <span class="c1">#### METHODS ####</span>
<div class="viewcode-block" id="Unit.set_name">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Unit.set_name">[docs]</a>
    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the name for the unit.</span>

<span class="sd">        .. deprecated:: 2.1</span>
<span class="sd">            Create a new unit with `Unit.create` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Setting the name for a unit after&quot;</span>
            <span class="s2">&quot;its creation is no longer supported, use&quot;</span>
            <span class="s2">&quot;&#39;Unit.create&#39; to create a new unit.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Unit.set_display_name">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Unit.set_display_name">[docs]</a>
    <span class="k">def</span> <span class="nf">set_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the display name for the unit.</span>

<span class="sd">        .. deprecated:: 2.1</span>
<span class="sd">            Create a new unit with `Unit.create` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Setting the display name for a unit after&quot;</span>
            <span class="s2">&quot;its creation is no longer supported, use&quot;</span>
            <span class="s2">&quot;&#39;Unit.create&#39; to create a new unit.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Unit.set_latex_name">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.Unit.set_latex_name">[docs]</a>
    <span class="k">def</span> <span class="nf">set_latex_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the LaTeX name for the unit.</span>

<span class="sd">        .. deprecated:: 2.1</span>
<span class="sd">            Create a new unit with `Unit.create` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Setting the LaTeX name for a unit after&quot;</span>
            <span class="s2">&quot;its creation is no longer supported, use&quot;</span>
            <span class="s2">&quot;&#39;Unit.create&#39; to create a new unit.&quot;</span>
        <span class="p">)</span></div>


    <span class="n">name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">fget</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">set_name</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The name of the unit&quot;</span>
    <span class="p">)</span>

    <span class="n">dispname</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">fget</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispname</span><span class="p">,</span>
        <span class="n">fset</span><span class="o">=</span><span class="n">set_display_name</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The display name of the unit&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">latexname</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">fget</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latexname</span><span class="p">,</span>
        <span class="n">fset</span><span class="o">=</span><span class="n">set_latex_name</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The LaTeX name of the unit&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1">#### REPRESENTATION ####</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispname</span>

    <span class="k">def</span> <span class="nf">_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latexname</span>

    <span class="k">def</span> <span class="nf">_repr_latex_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">$&quot;</span>

    <span class="k">def</span> <span class="nf">__array_ufunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;__call__&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="k">if</span> <span class="n">ufunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;multiply&quot;</span><span class="p">:</span>
            <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">inputs</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> * </span><span class="si">{</span><span class="n">second</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dispname</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">second</span><span class="o">.</span><span class="n">dispname</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">latexname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first</span><span class="o">.</span><span class="n">latexname</span><span class="si">}</span><span class="se">\\</span><span class="s2">,</span><span class="si">{</span><span class="n">second</span><span class="o">.</span><span class="n">latexname</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">scale</span> <span class="o">+</span> <span class="n">second</span><span class="o">.</span><span class="n">scale</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
                    <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">,</span>
                    <span class="n">dim</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">dim</span> <span class="o">*</span> <span class="n">second</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">dispname</span><span class="o">=</span><span class="n">dispname</span><span class="p">,</span>
                    <span class="n">latexname</span><span class="o">=</span><span class="n">latexname</span><span class="p">,</span>
                    <span class="n">iscompound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">u</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ufunc</span><span class="p">(</span>
                    <span class="o">*</span><span class="p">[</span>
                        <span class="n">Quantity</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="n">DIMENSIONLESS</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputs</span>
                    <span class="p">],</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">ufunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;divide&quot;</span><span class="p">:</span>
            <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">inputs</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">Unit</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">iscompound</span><span class="p">:</span>
                    <span class="n">dispname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dispname</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dispname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispname</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                <span class="n">dispname</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot; / &quot;</span>
                <span class="k">if</span> <span class="n">second</span><span class="o">.</span><span class="n">iscompound</span><span class="p">:</span>
                    <span class="n">dispname</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">second</span><span class="o">.</span><span class="n">dispname</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">second</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dispname</span> <span class="o">+=</span> <span class="n">second</span><span class="o">.</span><span class="n">dispname</span>
                    <span class="n">name</span> <span class="o">+=</span> <span class="n">second</span><span class="o">.</span><span class="n">name</span>

                <span class="n">latexname</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;\frac</span><span class="se">{{</span><span class="si">{</span><span class="n">first</span><span class="o">.</span><span class="n">latexname</span><span class="si">}</span><span class="se">}}{{</span><span class="si">{</span><span class="n">second</span><span class="o">.</span><span class="n">latexname</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">scale</span> <span class="o">-</span> <span class="n">second</span><span class="o">.</span><span class="n">scale</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
                    <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">,</span>
                    <span class="n">dim</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">dim</span> <span class="o">/</span> <span class="n">second</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">dispname</span><span class="o">=</span><span class="n">dispname</span><span class="p">,</span>
                    <span class="n">latexname</span><span class="o">=</span><span class="n">latexname</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                    <span class="n">iscompound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">u</span>
            <span class="k">elif</span> <span class="n">is_dimensionless</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">first</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">and</span> <span class="n">first</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ufunc</span><span class="p">(</span>
                    <span class="o">*</span><span class="p">[</span>
                        <span class="n">Quantity</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="n">DIMENSIONLESS</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputs</span>
                    <span class="p">],</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">ufunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;power&quot;</span><span class="p">:</span>
            <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">inputs</span>
            <span class="k">if</span> <span class="n">is_scalar_type</span><span class="p">(</span><span class="n">second</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">iscompound</span><span class="p">:</span>
                    <span class="n">dispname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">first</span><span class="o">.</span><span class="n">dispname</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">first</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="n">latexname</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\left(</span><span class="si">%s</span><span class="s2">\right)&quot;</span> <span class="o">%</span> <span class="n">first</span><span class="o">.</span><span class="n">latexname</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dispname</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">dispname</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">latexname</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">latexname</span>
                <span class="n">dispname</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;^</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">second</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; ** </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">second</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">latexname</span> <span class="o">+=</span> <span class="s2">&quot;^{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">%</span> <span class="n">latex</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="n">second</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
                    <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">,</span>
                    <span class="n">dim</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">dim</span><span class="o">**</span><span class="n">second</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">dispname</span><span class="o">=</span><span class="n">dispname</span><span class="p">,</span>
                    <span class="n">latexname</span><span class="o">=</span><span class="n">latexname</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                    <span class="n">iscompound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>  <span class="c1"># To avoid issues with units like (second ** -1) ** -1</span>
                <span class="k">return</span> <span class="n">u</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__pow__</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ufunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;square&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscompound</span><span class="p">:</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dispname</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">latexname</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\left(</span><span class="si">%s</span><span class="s2">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">latexname</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispname</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                <span class="n">latexname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latexname</span>
            <span class="n">dispname</span> <span class="o">+=</span> <span class="s2">&quot;^2&quot;</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot; ** 2&quot;</span>
            <span class="n">latexname</span> <span class="o">+=</span> <span class="s2">&quot;^2&quot;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
                <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">dispname</span><span class="o">=</span><span class="n">dispname</span><span class="p">,</span>
                <span class="n">latexname</span><span class="o">=</span><span class="n">latexname</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">iscompound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">u</span>
        <span class="k">elif</span> <span class="n">ufunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscompound</span><span class="p">:</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dispname</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">latexname</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\left(</span><span class="si">%s</span><span class="s2">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">latexname</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispname</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                <span class="n">latexname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latexname</span>
            <span class="n">dispname</span> <span class="o">+=</span> <span class="s2">&quot;^0.5&quot;</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot; ** 0.5&quot;</span>
            <span class="n">latexname</span> <span class="o">+=</span> <span class="s2">&quot;^0.5&quot;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
                <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">dispname</span><span class="o">=</span><span class="n">dispname</span><span class="p">,</span>
                <span class="n">latexname</span><span class="o">=</span><span class="n">latexname</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">iscompound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">u</span>
        <span class="k">elif</span> <span class="n">ufunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscompound</span><span class="p">:</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dispname</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">latexname</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\left(</span><span class="si">%s</span><span class="s2">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">latexname</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dispname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispname</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                <span class="n">latexname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latexname</span>
            <span class="n">dispname</span> <span class="o">+=</span> <span class="s2">&quot;^-1&quot;</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot; ** -1&quot;</span>
            <span class="n">latexname</span> <span class="o">+=</span> <span class="s2">&quot;^{-1}&quot;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span>
                <span class="mf">10.0</span><span class="o">**</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">dispname</span><span class="o">=</span><span class="n">dispname</span><span class="p">,</span>
                <span class="n">latexname</span><span class="o">=</span><span class="n">latexname</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">iscompound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">u</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Treat the unit as a Quantity (e.g. meter + meter should not fail but give 2*meter)</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__array_ufunc__</span><span class="p">(</span><span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Units cannot be modified in-place&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Units cannot be modified in-place&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Units cannot be modified in-place&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__idiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Units cannot be modified in-place&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Units cannot be modified in-place&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ifloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Units cannot be modified in-place&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__imod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Units cannot be modified in-place&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ipow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">modulo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Units cannot be modified in-place&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">dim</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Quantity</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__neq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span></div>



<span class="k">class</span> <span class="nc">UnitRegistry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores known units for printing in best units.</span>

<span class="sd">    All a user needs to do is to use the `register_new_unit`</span>
<span class="sd">    function.</span>

<span class="sd">    Default registries:</span>

<span class="sd">    The units module defines three registries, the standard units,</span>
<span class="sd">    user units, and additional units. Finding best units is done</span>
<span class="sd">    by first checking standard, then user, then additional. New</span>
<span class="sd">    user units are added by using the `register_new_unit` function.</span>

<span class="sd">    Standard units includes all the basic non-compound unit names</span>
<span class="sd">    built in to the module, including volt, amp, etc. Additional</span>
<span class="sd">    units defines some compound units like newton metre (Nm) etc.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    add</span>
<span class="sd">    __getitem__</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units_for_dimensions</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a unit to the registry&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="o">=</span> <span class="n">u</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units_for_dimensions</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">dim</span><span class="p">][</span><span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="o">=</span> <span class="n">u</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the best unit for quantity x</span>

<span class="sd">        The algorithm is to consider the value:</span>

<span class="sd">        m=abs(x/u)</span>

<span class="sd">        for all matching units u. We select the unit where this ratio is the</span>
<span class="sd">        closest to 10 (if it is an array with several values, we select the</span>
<span class="sd">        unit where the deviations from that are the smallest. More precisely,</span>
<span class="sd">        the unit that minimizes the sum of (log10(m)-1)**2 over all entries).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matching</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units_for_dimensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Unit not found in registry.&quot;</span><span class="p">)</span>

        <span class="n">matching_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">matching</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">print_opts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">get_printoptions</span><span class="p">()</span>
        <span class="n">edgeitems</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">print_opts</span><span class="p">[</span><span class="s2">&quot;edgeitems&quot;</span><span class="p">],</span> <span class="n">print_opts</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="c1"># Only care about optimizing the units for the values that will</span>
            <span class="c1"># actually be shown later</span>
            <span class="c1"># The code looks a bit complex, but should return the same numbers</span>
            <span class="c1"># that are shown by numpy&#39;s string conversion</span>
            <span class="n">slices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">shape</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">edgeitems</span><span class="p">:</span>
                    <span class="n">slices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgeitems</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="n">edgeitems</span><span class="p">,</span> <span class="kc">None</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">slices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),))</span>
            <span class="n">x_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">use_slices</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">use_slices</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">slices</span><span class="p">)]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">floatreps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x_flat</span><span class="p">),</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">matching</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">matching_values</span>
        <span class="c1"># ignore zeros, they are well represented in any unit</span>
        <span class="n">floatreps</span><span class="p">[</span><span class="n">floatreps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">floatreps</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">matching</span><span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>  <span class="c1"># all zeros, use the base unit</span>

        <span class="n">deviations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">floatreps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">matching</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">deviations</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>


<div class="viewcode-block" id="register_new_unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.register_new_unit">[docs]</a>
<span class="k">def</span> <span class="nf">register_new_unit</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a new unit for automatic displaying of quantities</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    u : `Unit`</span>
<span class="sd">        The unit that should be registered.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from brian2 import *</span>
<span class="sd">    &gt;&gt;&gt; 2.0*farad/metre**2</span>
<span class="sd">    2. * metre ** -4 * kilogram ** -1 * second ** 4 * amp ** 2</span>
<span class="sd">    &gt;&gt;&gt; register_new_unit(pfarad / mmetre**2)</span>
<span class="sd">    &gt;&gt;&gt; 2.0*farad/metre**2</span>
<span class="sd">    2000000. * pfarad / (mmetre ** 2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_unit_register</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></div>



<span class="c1">#: `UnitRegistry` containing all the standard units (metre, kilogram, um2...)</span>
<span class="n">standard_unit_register</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>
<span class="c1">#: `UnitRegistry` containing additional units (newton*metre, farad / metre, ...)</span>
<span class="n">additional_unit_register</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>
<span class="c1">#: `UnitRegistry` containing all units defined by the user</span>
<span class="n">user_unit_register</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>


<div class="viewcode-block" id="get_unit">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.get_unit">[docs]</a>
<span class="k">def</span> <span class="nf">get_unit</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find an unscaled unit (e.g. `volt` but not `mvolt`) for a `Dimension`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d : `Dimension`</span>
<span class="sd">        The dimension to find a unit for.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : `Unit`</span>
<span class="sd">        A registered unscaled `Unit` for the dimensions ``d``, or a new `Unit`</span>
<span class="sd">        if no unit was found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">unit_register</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">standard_unit_register</span><span class="p">,</span>
        <span class="n">user_unit_register</span><span class="p">,</span>
        <span class="n">additional_unit_register</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">if</span> <span class="mf">1.0</span> <span class="ow">in</span> <span class="n">unit_register</span><span class="o">.</span><span class="n">units_for_dimensions</span><span class="p">[</span><span class="n">d</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">unit_register</span><span class="o">.</span><span class="n">units_for_dimensions</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Unit</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">d</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">get_unit_for_display</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a string representation of an appropriate unscaled unit or ``&#39;1&#39;``</span>
<span class="sd">    for a dimensionless quantity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d : `Dimension` or int</span>
<span class="sd">        The dimension to find a unit for.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    s : str</span>
<span class="sd">        A string representation of the respective unit or the string ``&#39;1&#39;``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">d</span> <span class="ow">is</span> <span class="n">DIMENSIONLESS</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;1&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_unit</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>


<span class="c1">#### DECORATORS</span>


<div class="viewcode-block" id="check_units">
<a class="viewcode-back" href="../../unitSI.fundamentalunits.html#unitSI.check_units">[docs]</a>
<span class="k">def</span> <span class="nf">check_units</span><span class="p">(</span><span class="o">**</span><span class="n">au</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to check units of arguments passed to a function</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from brian2.units import *</span>
<span class="sd">    &gt;&gt;&gt; @check_units(I=amp, R=ohm, wibble=metre, result=volt)</span>
<span class="sd">    ... def getvoltage(I, R, **k):</span>
<span class="sd">    ...     return I*R</span>

<span class="sd">    You don&#39;t have to check the units of every variable in the function, and</span>
<span class="sd">    you can define what the units should be for variables that aren&#39;t</span>
<span class="sd">    explicitly named in the definition of the function. For example, the code</span>
<span class="sd">    above checks that the variable wibble should be a length, so writing</span>

<span class="sd">    &gt;&gt;&gt; getvoltage(1*amp, 1*ohm, wibble=1)  # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    DimensionMismatchError: Function &quot;getvoltage&quot; variable &quot;wibble&quot; has wrong dimensions, dimensions were (1) (m)</span>

<span class="sd">    fails, but</span>

<span class="sd">    &gt;&gt;&gt; getvoltage(1*amp, 1*ohm, wibble=1*metre)</span>
<span class="sd">    1. * volt</span>

<span class="sd">    passes. String arguments or ``None`` are not checked</span>

<span class="sd">    &gt;&gt;&gt; getvoltage(1*amp, 1*ohm, wibble=&#39;hello&#39;)</span>
<span class="sd">    1. * volt</span>

<span class="sd">    By using the special name ``result``, you can check the return value of the</span>
<span class="sd">    function.</span>

<span class="sd">    You can also use ``1`` or ``bool`` as a special value to check for a</span>
<span class="sd">    unitless number or a boolean value, respectively:</span>

<span class="sd">    &gt;&gt;&gt; @check_units(value=1, absolute=bool, result=bool)</span>
<span class="sd">    ... def is_high(value, absolute=False):</span>
<span class="sd">    ...     if absolute:</span>
<span class="sd">    ...         return abs(value) &gt;= 5</span>
<span class="sd">    ...     else:</span>
<span class="sd">    ...         return value &gt;= 5</span>

<span class="sd">    This will then again raise an error if the argument if not of the expected</span>
<span class="sd">    type:</span>

<span class="sd">    &gt;&gt;&gt; is_high(7)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; is_high(-7, True)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; is_high(3, 4)  # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: Function &quot;is_high&quot; expected a boolean value for argument &quot;absolute&quot; but got 4.</span>

<span class="sd">    If the return unit depends on the unit of an argument, you can also pass</span>
<span class="sd">    a function that takes the units of all the arguments as its inputs (in the</span>
<span class="sd">    order specified in the function header):</span>

<span class="sd">    &gt;&gt;&gt; @check_units(result=lambda d: d**2)</span>
<span class="sd">    ... def square(value):</span>
<span class="sd">    ...     return value**2</span>

<span class="sd">    If several arguments take arbitrary units but they have to be</span>
<span class="sd">    consistent among each other, you can state the name of another argument as</span>
<span class="sd">    a string to state that it uses the same unit as that argument.</span>

<span class="sd">    &gt;&gt;&gt; @check_units(summand_1=None, summand_2=&#39;summand_1&#39;)</span>
<span class="sd">    ... def multiply_sum(multiplicand, summand_1, summand_2):</span>
<span class="sd">    ...     &quot;Calculates multiplicand*(summand_1 + summand_2)&quot;</span>
<span class="sd">    ...     return multiplicand*(summand_1 + summand_2)</span>
<span class="sd">    &gt;&gt;&gt; multiply_sum(3, 4*mV, 5*mV)</span>
<span class="sd">    27. * mvolt</span>
<span class="sd">    &gt;&gt;&gt; multiply_sum(3*nA, 4*mV, 5*mV)</span>
<span class="sd">    27. * pwatt</span>
<span class="sd">    &gt;&gt;&gt; multiply_sum(3*nA, 4*mV, 5*nA)  # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    brian2.units.fundamentalunits.DimensionMismatchError: Function &#39;multiply_sum&#39; expected the same arguments for arguments &#39;summand_1&#39;, &#39;summand_2&#39;, but argument &#39;summand_1&#39; has unit V, while argument &#39;summand_2&#39; has unit A.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>

<span class="sd">    DimensionMismatchError</span>
<span class="sd">        In case the input arguments or the return value do not have the</span>
<span class="sd">        expected dimensions.</span>
<span class="sd">    TypeError</span>
<span class="sd">        If an input argument or return value was expected to be a boolean but</span>
<span class="sd">        is not.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This decorator will destroy the signature of the original function, and</span>
<span class="sd">    replace it with the signature ``(*args, **kwds)``. Other decorators will</span>
<span class="sd">    do the same thing, and this decorator critically needs to know the signature</span>
<span class="sd">    of the function it is acting on, so it is important that it is the first</span>
<span class="sd">    decorator to act on a function. It cannot be used in combination with</span>
<span class="sd">    another decorator that also needs to know the signature of the function.</span>

<span class="sd">    Note that the ``bool`` type is &quot;strict&quot;, i.e. it expects a proper</span>
<span class="sd">    boolean value and does not accept 0 or 1. This is not the case the other</span>
<span class="sd">    way round, declaring an argument or return value as &quot;1&quot; *does* allow for a</span>
<span class="sd">    ``True`` or ``False`` value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">do_check_units</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">new_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="n">newkeyset</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">arg_names</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arg_names</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="n">Quantity</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">au</span>
                <span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># allow e.g. to pass a Python list of values</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">au</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Argument </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> is not a unitless value/array.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Argument &#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&#39; is not a quantity, &quot;</span>
                                <span class="s2">&quot;expected a quantity with dimensions &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">au</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                <span class="n">newkeyset</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">newkeyset</span><span class="p">:</span>
                <span class="c1"># string variables are allowed to pass, the presumption is they</span>
                <span class="c1"># name another variable. None is also allowed, useful for</span>
                <span class="c1"># default parameters</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">k</span> <span class="ow">in</span> <span class="n">au</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)):</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                            <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Function &#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                                <span class="s2">&quot;expected a boolean value &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;for argument &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; but got &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                            <span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="n">newkeyset</span><span class="p">:</span>
                            <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Function &#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                                <span class="s2">&quot;expected its argument to have the &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;same units as argument &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39;, but &quot;</span>
                                <span class="s2">&quot;there is no argument of that name&quot;</span>
                            <span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">newkeyset</span><span class="p">[</span><span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">]]):</span>
                            <span class="n">d1</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                            <span class="n">d2</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">newkeyset</span><span class="p">[</span><span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
                            <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Function &#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; expected &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;the argument &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; to have the same &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;units as argument &#39;</span><span class="si">{</span><span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, but &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;argument &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; has &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;unit </span><span class="si">{</span><span class="n">get_unit_for_display</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span><span class="si">}</span><span class="s2">, &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;while argument &#39;</span><span class="si">{</span><span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;has unit </span><span class="si">{</span><span class="n">get_unit_for_display</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                            <span class="p">)</span>
                            <span class="k">raise</span> <span class="n">DimensionMismatchError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                        <span class="n">unit</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">au</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Function &#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                            <span class="s2">&quot;expected a quantity with unit &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2"> for argument &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; but got &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="n">DimensionMismatchError</span><span class="p">(</span>
                            <span class="n">error_message</span><span class="p">,</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">newkeyset</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;result&quot;</span> <span class="ow">in</span> <span class="n">au</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">au</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">],</span> <span class="n">Callable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">au</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="nb">bool</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="n">expected_result</span> <span class="o">=</span> <span class="n">au</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="n">get_dimensions</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expected_result</span> <span class="o">=</span> <span class="n">au</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">au</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)):</span>
                        <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The return value of function &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; was expected to be &quot;</span>
                            <span class="s2">&quot;a boolean value, but was of type &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">have_same_dimensions</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">):</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">get_unit_for_display</span><span class="p">(</span><span class="n">expected_result</span><span class="p">)</span>
                    <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;The return value of function &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; was expected to have &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;unit </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2"> but was &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">DimensionMismatchError</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">new_f</span><span class="o">.</span><span class="n">_orig_func</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">new_f</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="n">new_f</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="c1"># store the information in the function, necessary when using the</span>
        <span class="c1"># function in expressions or equations</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;_orig_arg_names&quot;</span><span class="p">):</span>
            <span class="n">arg_names</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">_orig_arg_names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arg_names</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">[:</span> <span class="n">f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">]</span>
        <span class="n">new_f</span><span class="o">.</span><span class="n">_arg_names</span> <span class="o">=</span> <span class="n">arg_names</span>
        <span class="n">new_f</span><span class="o">.</span><span class="n">_arg_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">au</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">arg_names</span><span class="p">]</span>
        <span class="n">return_unit</span> <span class="o">=</span> <span class="n">au</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_f</span><span class="o">.</span><span class="n">_return_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_f</span><span class="o">.</span><span class="n">_return_unit</span> <span class="o">=</span> <span class="n">return_unit</span>
        <span class="k">if</span> <span class="n">return_unit</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">new_f</span><span class="o">.</span><span class="n">_returns_bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_f</span><span class="o">.</span><span class="n">_returns_bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">new_f</span><span class="o">.</span><span class="n">_orig_arg_names</span> <span class="o">=</span> <span class="n">arg_names</span>

        <span class="c1"># copy any annotation attributes</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;_annotation_attributes&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">_annotation_attributes</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">new_f</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">attrname</span><span class="p">))</span>
        <span class="n">new_f</span><span class="o">.</span><span class="n">_annotation_attributes</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;_annotation_attributes&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span>
            <span class="s2">&quot;_arg_units&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_arg_names&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_return_unit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_orig_func&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_returns_bool&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">new_f</span>

    <span class="k">return</span> <span class="n">do_check_units</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">unitSI</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">unitSI</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Sorin Birchi.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>